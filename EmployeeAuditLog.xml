<?xml version="1.0" encoding="Windows-1252"?>
<root>
	<VersionInfo>
		<Filename>EmployeeAuditReport.xml</Filename>
		<Revision>1.18</Revision>
		<NMLVersion>5.04.11.02.18</NMLVersion>
		<Developer>Niche</Developer>
		<NicheBuildName>BexarCounty</NicheBuildName>
		<BuildTime>2018/07/21 22:08:12</BuildTime>
	</VersionInfo>

	<!-- Information to be used when loading the report -->
	<!-- One of these for each allowed entity -->
	<AllowedEntity>Person</AllowedEntity>

	<!-- Is this report for an entire domain, rather than an instance of data -->
	<IsDomainReport>0</IsDomainReport>

	<!-- Should this show up in the list of reports for an entity in the print menu -->
	<IsPrintTemplate>1</IsPrintTemplate>

	<!-- Suggested report name in the print menu -->
	<ReportName>Employee audit report</ReportName>

	<!-- Can be enclosed in CDATA.  A general description of what the report does -->
	<Documentation><![CDATA[
		This report displays information about an employee's activities
	]]></Documentation>

	<ReportPaperOrientation>landscape</ReportPaperOrientation>

	<SQLParameter>StartTime</SQLParameter>
	<SQLParameter>EndTime</SQLParameter>
	<SQLParameter>TransactionType</SQLParameter>
	<SQLParameter>ShowFailedLogons</SQLParameter>
	<SQLParameter>Entities</SQLParameter>
	<SQLParameter>UseNoLock</SQLParameter>

	<XSLTParameter>StartTimeG</XSLTParameter>
	<XSLTParameter>EndTimeG</XSLTParameter>
	<XSLTParameter>ShowConfidential</XSLTParameter>
	<XSLTParameter>MarkConfidential</XSLTParameter>
	<XSLTParameter>ReportPurpose</XSLTParameter>
	<XSLTParameter>RecipientName</XSLTParameter>
	<XSLTParameter>RecipientUnit</XSLTParameter>
	<XSLTParameter>RecipientTelephone</XSLTParameter>
	<XSLTParameter>TransactionTypeG</XSLTParameter>
	<XSLTParameter>ShowFailedLogons</XSLTParameter>
	<XSLTParameter>ShowIPAddress</XSLTParameter>
	<XSLTParameter>EntitiesG</XSLTParameter>


	<ReportHeader><![CDATA[e"""<p align='center'><b>[@PARAM=PROTECTIVEMARKING]</b></p>"]]></ReportHeader>


	<ReportFooter><![CDATA[e"""<p align='center'><b>[@PARAM=PROTECTIVEMARKING]</b></p><p align='center'>"e"Printed by:""&nbsp;&nbsp;[@AGBL=USERNUM]&nbsp;&nbsp;&nbsp;"e"Date:""&nbsp;&nbsp;[DATE] [TIME]&nbsp;&nbsp;&nbsp;"e"Computer:""&nbsp;&nbsp;[@AGBL=COMPUTERNAME]&nbsp;&nbsp;&nbsp;"e"Page"" [PAGENUM] of [PAGETOTAL]</p>"]]></ReportFooter>

	<OutputType>html;xml</OutputType>

	<SQLSelectXSLT><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
				<xsl:param name="StartTime" />
				<xsl:param name="EndTime" />
				<xsl:param name="TransactionType" />
				<xsl:param name="ShowFailedLogons" />
				<xsl:param name="Entities" />
				<xsl:param name="UseNoLock" />
				<xsl:param name="PARAM_ID" />
				<xsl:output method="text" omit-xml-declaration="yes" />

				<xsl:template match="/">
					----------------------------------------------------------
					--  XML filename: EmployeeAuditReport.xml
					--  File revision: 1.18
					--  NML version: 5.04.11.02.18
					--  Developer: Niche
					--  Niche build name: BexarCounty
					--  Build time: 2018/07/21 22:08:12
					----------------------------------------------------------


					EXEC PR_SetSQLWrapOverride 'true'

					<xsl:call-template name="GenerateSQLFromMultipleIds">
						<xsl:with-param name="IdString" select="$PARAM_ID" />
					</xsl:call-template>



					EXEC PR_SetSQLWrapOverride 'false'

					SELECT
						NACRole__Id,
						NACRole__NameG

					FROM NACRole <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>



					SELECT SPValue AS AgencyName FROM SystemParameterSettingForACC WHERE SPKey='Label.AgencyName'
					SELECT SPValue AS DivisionName, 1 AS CFDSIgnoreDataSetChanges FROM SystemParameterSettingForACC WHERE SPKey='Label.DivisionName'
					SELECT EmployeeNumber AS CurrentEmployeeNumber, Label AS CurrentUser, 1 AS CFDSIgnoreDataSetChanges FROM GPerson WHERE Id=@currentUserId


				</xsl:template>


				<xsl:template name="GenerateSQLFromMultipleIds">
					<xsl:param name="IdString" />

					<xsl:choose>
						<xsl:when test="contains($IdString, ',')">
							<xsl:call-template name="GenerateSQLFromSingleId">
								<xsl:with-param name="Id" select="substring-before($IdString, ',')" />
							</xsl:call-template>
							<xsl:call-template name="GenerateSQLFromMultipleIds">
								<xsl:with-param name="IdString" select="substring-after($IdString, ',')" />
							</xsl:call-template>
						</xsl:when>
						<xsl:otherwise>
							<xsl:call-template name="GenerateSQLFromSingleId">
								<xsl:with-param name="Id" select="$IdString" />
							</xsl:call-template>
						</xsl:otherwise>
					</xsl:choose>

				</xsl:template>


				<xsl:template name="GenerateSQLFromSingleId">
					<xsl:param name="Id" />
					SET @auditUserId = 'NULL'

					SELECT
						@auditUserId = Person__UserID,
						Person__Id,
						Person__UserID,
						Person__EmployeeNumber_cache,

						GPersonName__SurnameStore,
						GPersonName__Given1,
						GPersonName__Given2,
						GPersonName__Given3,
						GPersonName__DistinctTitleG,

						GPersonOrgMemberGPerson__EffectiveFromTimeDG,
						GPersonOrgMemberGPerson__EffectiveToTimeDG,
						GPersonOrgMemberGPerson__AssignmentTypeG,

						OrgPolice__Surname_cacheG

					FROM Person <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
						LEFT JOIN GPersonName <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
							ON ChoiceHasProperty(GPersonName.Type1, 'cl_GPersonNameType', 'clvIsPrimary', '1') = 1
						LEFT JOIN (GPersonOrgMemberGPerson <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
							LEFT JOIN OrgPolice <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								ON GPersonOrgMemberGPerson.LId = OrgPolice.Id
						) ON GPersonOrgMemberGPerson.RId = Person.Id and GPersonOrgMemberGPerson.IsEffectiveAssignment = 1

					WHERE Person.Id = <xsl:value-of select="$Id" />

					ORDER BY
						GPersonName.SurnameStore ASC,
						GPersonName.Given1 ASC,
						Person.EmployeeNumber_cache ASC




					<xsl:if test="$ShowFailedLogons = '1'">
<!--						 Failed log-on attempts-->
						SELECT
							FailedLogon__Id,
							FailedLogon__InitialWorkstation,
							FailedLogon__StartTimeTZV2GL,
							FailedLogon__InitialIPAddress,
							FailedLogon__LoginUserId

						FROM
							AuditLogSession FailedLogon <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>

						WHERE LoginUserId = @auditUserId AND @auditUserId &lt;&gt; 'NULL'
							AND EXISTS
							(
								SELECT Id
								FROM AuditLogBatch <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								WHERE EXISTS
								(
									SELECT Id
									FROM AuditLogActivity <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
									WHERE ChoiceHasProperty(ClientEventSuccessfulCompletion, 'cl_YesNo', 'clvIsNo', '1') = 1
										AND EXISTS
										(
											SELECT Id FROM ALAELogin WHERE ALAELogin.WId = AuditLogActivity.Id
										)
										AND AuditLogBatch.Id = AuditLogActivity.WId
								)
								AND FailedLogon.Id = AuditLogBatch.WId
							)
							<xsl:call-template name="CreateDateCondition">
								<xsl:with-param name="FieldName">FailedLogon.StartTimeTZV2I</xsl:with-param>
								<xsl:with-param name="StartTime" select="$StartTime" />
								<xsl:with-param name="EndTime" select="$EndTime" />
								<xsl:with-param name="Prefix"><xsl:text> AND </xsl:text></xsl:with-param>
							</xsl:call-template>

						ORDER BY FailedLogon.StartTimeTZV2I ASC


					</xsl:if>

					SELECT


<!--					 Batch info-->
						Batch__Id,
<!--
						Batch__FirstALAETimeDG,
						Batch__FirstALAETimeFL(format='24H') as Batch__FirstALAETimeOnlyG,
-->
						Batch__FirstALAETimeTZV2GL,
						Batch__EffectiveWorkstation,
						Batch__EffectiveIPAddress,
						Batch__ConnectedInstanceEntityName,
						Batch__ConnectedInstanceSummaryXML,
						Batch__ConnectedInstanceIdConverted,
						Batch__EffectiveUserRoleIdConverted,

						Batch__UpdatedEntities,
						Batch__DeletedEntities,
						Batch__InsertedEntities,
						Batch__SetImageEntities,
						Batch__GetImageEntities,

<!--						 Search info-->
						Batch__SearchEntity,
						Batch__SearchEntityName,
						Batch__SearchTypeG,
						Batch__LabelSearchSpec,

<!--						Window open info-->
						Batch__ConnectedWindow,

						ALAEInstanceActionData__Id,
						ALAEInstanceActionData__EntityName,
						ALAEInstanceActionData__EntityDisplayName,
						ALAEInstanceActionData__InstanceSummaryXML,
						ALAEInstanceActionData__InstanceIdEntityName,
						ALAEInstanceActionData__InstanceIdDisplayName,
						ALAEInstanceActionData__InstanceIdConverted,

						ALAEInstanceDelete__InstanceLabel,
						ALAEInstanceDelete__InstanceLabelLeft,
						ALAEInstanceDelete__InstanceLabelRight,

						ALAENonInstanceAction__Id,
						ALAENonInstanceAction__EntityName,
						ALAENonInstanceAction__EntityDisplayName,

						ALAECEImageOperation__Attributes,
						ALAECEImageOperation__FieldName,
						ALAECEImageOperation__OperationSubTypeG,

						ALAECSReasonForAccess__Reason

					FROM AuditLogBatch Batch <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
						LEFT JOIN (AuditLogActivity Activity <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
							LEFT JOIN (ALAEInstanceAction ALAEInstanceActionData <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								LEFT JOIN ALAECEImageOperation <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								LEFT JOIN ALAEInstanceDelete <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
							) ON IsSpecialization(ALAEInstanceActionData.Id, 'ALAEInstanceSQL', 'ALAEInstanceSelect') = 0
							LEFT JOIN ALAENonInstanceAction <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								ON IsSpecialization(ALAENonInstanceAction.Id, 'ALAECSReasonForAccess') = 1
						)
						LEFT JOIN (AuditLogSession <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
							LEFT JOIN (AuditLogBatch RFABatch <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								LEFT JOIN (AuditLogActivity RFAActivity <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
									LEFT JOIN ALAECSReasonForAccess <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								)
							) ON EXISTS (
								SELECT Id
								FROM ALAENonInstanceAction RFANIA <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								WHERE RFANIA.BatchId = RFABatch.Id
									AND IsSpecialization(RFANIA.Id, 'ALAECSReasonForAccess') = 1
									AND RFABatch.FirstALAETimeTZV2I &lt;= Batch.FirstALAETimeTZV2I)
						)

					<!-- User ID and time range are mandatory -->
					WHERE HierarchicalResult = 1
					AND (Batch.EffectiveUserId = @auditUserId) AND @auditUserId &lt;&gt; 'NULL'
					<xsl:call-template name="CreateDateCondition">
						<xsl:with-param name="FieldName">Batch.FirstALAETimeTZV2I</xsl:with-param>
						<xsl:with-param name="StartTime" select="$StartTime" />
						<xsl:with-param name="EndTime" select="$EndTime" />
						<xsl:with-param name="Prefix">AND </xsl:with-param>
					</xsl:call-template>

					<!-- The other parameters are optional -->
					<!-- Compose the list of instance action types that we're interested in -->
					<xsl:variable name="InstanceActionEntities">
						<xsl:call-template name="ComposeWith">
							<xsl:with-param name="Separator"><xsl:text>, </xsl:text></xsl:with-param>
							<xsl:with-param name="Strings">
								<String>
									<xsl:if test="contains($TransactionType, ';IN;')">
										<xsl:call-template name="StuffSQL">
											<xsl:with-param name="ToStuff">ALAEInstanceInsert</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</String>
								<String>
									<xsl:if test="contains($TransactionType, ';DE;')">
										<xsl:call-template name="StuffSQL">
											<xsl:with-param name="ToStuff">ALAEInstanceDelete</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</String>
								<String>
									<xsl:if test="contains($TransactionType, ';UP;')">
										<xsl:call-template name="StuffSQL">
											<xsl:with-param name="ToStuff">ALAEInstanceUpdate</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</String>
								<String>
									<xsl:if test="contains($TransactionType, ';SL;')">
										<xsl:call-template name="StuffSQL">
											<xsl:with-param name="ToStuff">ALAEInstanceSelect</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</String>
								<String>
									<xsl:if test="contains($TransactionType, ';GI;')">
										<xsl:call-template name="StuffSQL">
											<xsl:with-param name="ToStuff">ALAECEGGetImage</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</String>
								<String>
									<xsl:if test="contains($TransactionType, ';SI;')">
										<xsl:call-template name="StuffSQL">
											<xsl:with-param name="ToStuff">ALAECEGSetImage</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</String>
							</xsl:with-param>
						</xsl:call-template>
					</xsl:variable>

					<xsl:variable name="InstanceActionSubquery">
						<xsl:if test="$Entities != '' or $InstanceActionEntities != ''">EXISTS (
								SELECT Id FROM ALAEInstanceAction <xsl:if test="$UseNoLock = '1'"><xsl:text>WITH (NOLOCK) </xsl:text></xsl:if>
								WHERE ALAEInstanceAction.BatchId = Batch.Id<xsl:if test="$Entities != ''">
								AND IsSpecialization(ALAEInstanceAction.InstanceId, <xsl:value-of select="$Entities" />) = 1</xsl:if>
								<xsl:if test="$InstanceActionEntities != ''">
								AND IsSpecialization(ALAEInstanceAction.Id, <xsl:value-of select="$InstanceActionEntities" />) = 1</xsl:if>
							)</xsl:if>
					</xsl:variable>

					<xsl:variable name="apos"><xsl:text>'</xsl:text></xsl:variable>
					<xsl:variable name="SearchCondition">
						<xsl:if test="contains($TransactionType, ';SR;')">Batch.SearchType IS NOT NULL <xsl:if test="$Entities != ''">AND Batch.SearchEntity IN (<xsl:if test="contains($Entities, concat($apos, 'Person', $apos))">/*Person*/ 1500, /*GPerson*/ 1200,</xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'OrgGeneral', $apos))">/*OrgGeneral*/ 1401, /*Organization*/ 1400, /*GPerson*/ 1200, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'OrgCriminal', $apos))">/*OrgCriminal*/ 1402, /*Organization*/ 1400, /*GPerson*/ 1200, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'PhysicalAddress', $apos))">/*PhysicalAddress*/ 1804, /*GAddress*/ 1800, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Telephone', $apos))">/*Telephone*/ 1807, /*CommAddress*/ 1806, /*GAddress*/ 1800, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'EMail', $apos))">/*EMail*/ 1808, /*CommAddress*/ 1806, /*GAddress*/ 1800, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GVehicle', $apos))">/*GVehicle*/ 1738, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Aircraft', $apos))">/*Aircraft*/ 1743, /*GVehicle*/ 1738, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Vehicle', $apos))">/*Vehicle*/ 1740, /*GVehicle*/ 1738, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'VehicleLicense', $apos))">/*VehicleLicense*/ 1739, /*GVehicle*/ 1738, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Watercraft', $apos))">/*Watercraft*/ 1742, /*GVehicle*/ 1738, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GNVProperty', $apos))">/*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Alcohol', $apos))">/*Alcohol*/ 1746, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Animal', $apos))">/*Animal*/ 1783, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Bicycle', $apos))">/*Bicycle*/ 1733, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Drug', $apos))">/*Drug*/ 1737, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Firearm', $apos))">/*Firearm*/ 1736, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GeneralProperty', $apos))">/*GeneralProperty*/ 1732, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'InvestProperty', $apos))">/*InvestProperty*/ 1730, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'PoliceDocument', $apos))">/*PoliceDocument*/ 1731, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Security', $apos))">/*Security*/ 1735, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'WatercraftMotor', $apos))">/*WatercraftMotor*/ 1734, /*GNVProperty*/ 1729, /*GProperty*/ 1700, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Occurrence', $apos))">/*Occurrence*/ 903, /*CFSOccurrence*/ 902, /*GOccurrence*/ 900, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'SCOccurrence', $apos))">/*SCOccurrence*/ 901, /*GOccurrence*/ 900, </xsl:if>
									<!-- Reports aren't searched for -->
									<!-- Charges aren't searched for -->
									<xsl:if test="contains($Entities, concat($apos, 'CourtFolder', $apos))">/*CourtFolder*/ 2000, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'Task', $apos))">/*Task*/ 10501, /*GTask*/ 10500, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GTask', $apos))">/*GTask*/ 10500, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'POATicketSetItem', $apos))">/*POATicketSetItem*/ 1369, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GPersonPolCustody', $apos))">/*GPersonPolCustody*/ 1249, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GOccurrenceTREventActivityLog', $apos))">/*GOccurrenceTREventActivityLog*/ 20515, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GOccReport', $apos))">/*GOccReport*/ 906, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'ExtDocOccReport', $apos))">/*ExtDocOccReport*/ 941, /*GOccReport*/ 906, </xsl:if>
									<xsl:if test="contains($Entities, concat($apos, 'GOccPropertySeizure', $apos))">/*GOccPropertySeizure*/ 1112, /*GOccReportContainer*/ 998, /*GOccReport*/ 906, </xsl:if> /*NULL*/ 0)
							</xsl:if>
						</xsl:if>
					</xsl:variable>
					AND
					(
						<xsl:call-template name="ComposeWith">
							<xsl:with-param name="Separator"><xsl:text>
						OR </xsl:text></xsl:with-param>
							<xsl:with-param name="Strings">
								<String><xsl:value-of select="$InstanceActionSubquery" /></String>
								<String><xsl:if test="contains($TransactionType, ';OP;')">Batch.ConnectedInstanceId IS NOT NULL <xsl:if test="$Entities != ''">AND IsSpecialization(Batch.ConnectedInstanceId, <xsl:value-of select="$Entities" />) = 1</xsl:if></xsl:if>
								</String>
								<String><xsl:value-of select="$SearchCondition" /></String>
							</xsl:with-param>
						</xsl:call-template>
					)

					ORDER BY
						Batch.FirstALAETimeTZV2I ASC,
						Activity.StartTimeTZV2I ASC,
						ALAEInstanceActionData.EntityDisplayName ASC,
						ALAENonInstanceAction.EntityDisplayName ASC,
						RFABatch.FirstALAETimeTZV2I DESC,
						RFAActivity.StartTimeTZV2I DESC,
						ALAECSReasonForAccess.TimeTZV2I DESC
				</xsl:template>


				<xsl:template name="Split">
					<xsl:param name="String" />
					<xsl:param name="Delimiter" select="';'" />
					<xsl:param name="DiscardBlank" select="'0'" />

					<xsl:choose>
						<xsl:when test="not(contains($String, $Delimiter))">
							<xsl:if test="$String != '' or $DiscardBlank = '0'">
								<String><xsl:value-of select="$String" /></String>
							</xsl:if>
						</xsl:when>
						<xsl:otherwise>
							<xsl:if test="$DiscardBlank = '0' or ($DiscardBlank = '1' and substring-before($String, $Delimiter) != '')">
								<String><xsl:value-of select="substring-before($String, $Delimiter)" /></String>
							</xsl:if>
							<xsl:call-template name="Split">
								<xsl:with-param name="String" select="substring-after($String, $Delimiter)" />
								<xsl:with-param name="Delimiter" select="$Delimiter" />
								<xsl:with-param name="DiscardBlank" select="$DiscardBlank" />
							</xsl:call-template>
						</xsl:otherwise>
					</xsl:choose>

				</xsl:template>



				<xsl:template name="StuffSQL">
					<xsl:param name="ToStuff" />
					<xsl:text>'</xsl:text><xsl:call-template name="StuffSQLPart"><xsl:with-param name="ToStuff"><xsl:value-of select="$ToStuff" /></xsl:with-param></xsl:call-template><xsl:text>'</xsl:text>
				</xsl:template>

				<xsl:template name="StuffSQLPart">
					<xsl:param name="ToStuff" />
					<xsl:variable name="SingleQuote">'</xsl:variable>
					<xsl:choose>
						<xsl:when test="contains($ToStuff, $SingleQuote)">
							<xsl:value-of select="substring-before($ToStuff, $SingleQuote)" />
							<xsl:text>''</xsl:text>
							<xsl:call-template name="StuffSQLPart">
								<xsl:with-param name="ToStuff"><xsl:value-of select="substring-after($ToStuff, $SingleQuote)" /></xsl:with-param>
							</xsl:call-template>
						</xsl:when>
						<xsl:otherwise>
							<xsl:value-of select="$ToStuff" />
						</xsl:otherwise>
					</xsl:choose>
				</xsl:template>


				<xsl:template name="ComposeWith" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
					<xsl:param name="Strings" />
					<xsl:param name="Separator">
						<xsl:text> / </xsl:text>
					</xsl:param>
					<xsl:for-each select="msxsl:node-set($Strings)/String">
						<xsl:if test="string-length(text()) &gt; 0 and count(preceding-sibling::String[string-length(.) &gt; 0]) &gt; 0">
							<xsl:value-of select="$Separator" />
						</xsl:if>
						<xsl:value-of select="./text()" />
					</xsl:for-each>
				</xsl:template>



				<xsl:template name="CreateDateCondition">
					<xsl:param name="FieldName" />
					<xsl:param name="StartTime" />
					<xsl:param name="EndTime" />
					<xsl:param name="Prefix"><xsl:text> ON </xsl:text></xsl:param>

					<xsl:if test="string-length($StartTime) &gt; 0 or string-length($EndTime) &gt; 0"><xsl:value-of select="$Prefix" /></xsl:if>
					<xsl:call-template name="ComposeWith">
						<xsl:with-param name="Separator"><xsl:text> AND </xsl:text></xsl:with-param>
						<xsl:with-param name="Strings">
							<xsl:if test="string-length($StartTime) &gt; 0">
								<String><xsl:value-of select="$FieldName" /> &gt;= <xsl:call-template name="StuffSQL"><xsl:with-param name="ToStuff" select="$StartTime" /></xsl:call-template></String>
							</xsl:if>
							<xsl:if test="string-length($EndTime) &gt; 0">
								<String><xsl:value-of select="$FieldName" /> &lt;= <xsl:call-template name="StuffSQL"><xsl:with-param name="ToStuff" select="$EndTime" /></xsl:call-template></String>
							</xsl:if>
						</xsl:with-param>
					</xsl:call-template>
				</xsl:template>


				<xsl:template name="CreateConditionFromSet">
					<xsl:param name="FieldName" />
					<xsl:param name="FieldValue" />
					<xsl:param name="IsSetField" />
					<xsl:param name="Prefix" />

					<xsl:variable name="Condition">
						<xsl:call-template name="CreateConditionFromSet_Recursive">
							<xsl:with-param name="FieldName" select="$FieldName" />
							<xsl:with-param name="FieldValue" select="substring($FieldValue, 2, string-length($FieldValue) - 2)" />
							<xsl:with-param name="IsSetField" select="$IsSetField" />
						</xsl:call-template>
					</xsl:variable>
					<xsl:if test="string-length($Condition) &gt; 0">
						<xsl:value-of select="$Prefix" /><xsl:text>(</xsl:text>
							<xsl:value-of select="$Condition" />
						<xsl:text>)</xsl:text>
					</xsl:if>
				</xsl:template>

				<xsl:template name="CreateConditionFromSet_Recursive">
					<xsl:param name="FieldName" />
					<xsl:param name="FieldValue" />
					<xsl:param name="IsSetField" />
					<xsl:param name="Prefix" />

					<xsl:variable name="ComparisonOperator">
						<xsl:choose>
							<xsl:when test="$IsSetField = '1'"><xsl:text> LIKE </xsl:text></xsl:when>
							<xsl:otherwise><xsl:text> = </xsl:text></xsl:otherwise>
						</xsl:choose>
					</xsl:variable>

					<xsl:if test="string-length($FieldValue) &gt; 0">

						<xsl:choose>
							<xsl:when test="contains($FieldValue, ';')">
								<xsl:value-of select="$Prefix" />
								<xsl:value-of select="$FieldName" />
								<xsl:value-of select="$ComparisonOperator" />
								<xsl:call-template name="StuffSQL">
									<xsl:with-param name="ToStuff">
										<xsl:choose>
											<xsl:when test="$IsSetField = '1'"><xsl:text>%;</xsl:text><xsl:value-of select="substring-before($FieldValue, ';')" /><xsl:text>;%</xsl:text></xsl:when>
											<xsl:otherwise><xsl:value-of select="substring-before($FieldValue, ';')" /></xsl:otherwise>
										</xsl:choose>
									</xsl:with-param>
								</xsl:call-template>
								<xsl:call-template name="CreateConditionFromSet_Recursive">
									<xsl:with-param name="Prefix"><xsl:text> OR </xsl:text></xsl:with-param>
									<xsl:with-param name="FieldName" select="$FieldName" />
									<xsl:with-param name="FieldValue" select="substring-after($FieldValue, ';')" />
									<xsl:with-param name="IsSetField" select="$IsSetField" />
								</xsl:call-template>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="$Prefix" />
								<xsl:value-of select="$FieldName" />
								<xsl:value-of select="$ComparisonOperator" />
								<xsl:call-template name="StuffSQL">
									<xsl:with-param name="ToStuff">
										<xsl:choose>
											<xsl:when test="$IsSetField = '1'"><xsl:text>%;</xsl:text><xsl:value-of select="$FieldValue" /><xsl:text>;%</xsl:text></xsl:when>
											<xsl:otherwise><xsl:value-of select="$FieldValue" /></xsl:otherwise>
										</xsl:choose>
									</xsl:with-param>
								</xsl:call-template>
							</xsl:otherwise>
						</xsl:choose>

					</xsl:if>

				</xsl:template>


			</xsl:stylesheet>]]></SQLSelectXSLT>

	<Report>
		<FileType>Excel</FileType>
		<FileExtension>csv</FileExtension>
		<DataElementName>Data</DataElementName>
		<AllowPrint>1</AllowPrint>
		<AllowSave>1</AllowSave>
		<AllowPrintPreview>1</AllowPrintPreview>
		<AllowPagedPreview>1</AllowPagedPreview>
		<AllowEmail>1</AllowEmail>
		<XSLT>
			<![CDATA[<?xml version="1.0" encoding="Windows-1252"?>
				<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:nicheFunctions="urn:nicheFunctions" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
					<xsl:param name="StartTimeG" />
					<xsl:param name="EndTimeG" />
					<xsl:param name="ShowConfidential" />
					<xsl:param name="MarkConfidential" />
					<xsl:param name="ReportPurpose" />
					<xsl:param name="RecipientName" />
					<xsl:param name="RecipientUnit" />
					<xsl:param name="RecipientTelephone" />
					<xsl:param name="TransactionTypeG" />
					<xsl:param name="ShowFailedLogons" />
					<xsl:param name="ShowIPAddress" />
					<xsl:param name="EntitiesG" />

					<xsl:output method="xml" indent="yes" omit-xml-declaration="yes" />

					<xsl:template match="/">
						<Data>
							<xsl:call-template name="ConvertHTMLTableToCSV">
								<xsl:with-param name="HTMLTable">

								<table>
									<tr>
									<th>Audit ID</th>
<!--
									<th>Trans. date</th>
									<th>Trans. time</th>
-->
									<th>Trans. date/time</th>
									<th>Trans. type</th>
									<th>Entity type</th>
									<th>Entity ID</th>
									<th>Niche ID</th>
									<th>Entity/search info</th>
									<th>Role</th>
									<th>Machine</th>
									<th>RFA entry</th>
									<th>Questionnaire results</th>
									</tr>

									<xsl:for-each select="/DATASETLIST/DATASET/ROW[Batch__Id]">

										<xsl:variable name="CurrentBatch" select="." />
										<xsl:variable name="CurrentBatchPosition" select="position()" />

										<xsl:variable name="InstanceSQLIds">
											<xsl:call-template name="ComposeWith">
												<xsl:with-param name="Separator">;</xsl:with-param>
												<xsl:with-param name="Strings">
													<xsl:for-each select="DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__EntityName = 'ALAEInstanceSQL']">
														<String><xsl:value-of select="ALAEInstanceActionData__InstanceIdConverted" /></String>
													</xsl:for-each>
												</xsl:with-param>
											</xsl:call-template>
										</xsl:variable>

										<tr><td colspan="100" style="height:1px;background:#888888"><xsl:text> </xsl:text></td></tr>

										<xsl:if test="Batch__ConnectedInstanceIdConverted != '' or Batch__ClientDataOutputSummaryTypeG != '' or Batch__SearchEntity != ''">
											<tr>
												<xsl:attribute name="style">
													<xsl:choose>
														<xsl:when test="$MarkConfidential = '1' and count(msxsl:node-set($CurrentBatch)//*[ProtectiveMarkingIsConfidential = 'True']) &gt; 0">
															<xsl:choose>
																<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEB958;border-color:#EEB958;</xsl:when>
																<xsl:otherwise>background:#FFCA69;border-color:#FFCA69;</xsl:otherwise>
															</xsl:choose>
														</xsl:when>
														<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEEEEE;border-color:#EEEEEE;</xsl:when>
														<xsl:otherwise>background:white;border-color:white;</xsl:otherwise>
													</xsl:choose>
												</xsl:attribute>

												<!-- Audit ID -->
												<td><a href="nds://{Batch__Id}"><xsl:value-of select="Batch__Id" /></a></td>

												<!-- Trans. date -->
												<td><xsl:value-of select="Batch__FirstALAETimeTZV2GL" /></td>

												<!-- Trans. time -->
<!--
												<td><xsl:value-of select="Batch__FirstALAETimeOnlyG" /></td>
-->
												<!-- Trans. type -->
												<td>
													<xsl:choose>
														<xsl:when test="Batch__ConnectedInstanceIdConverted != ''">
															<xsl:choose>
																<xsl:when test="Batch__ConnectedWindow = 'w_appcontrolrms'">Open RMS launchpad</xsl:when>
																<xsl:otherwise>Open window</xsl:otherwise>
															</xsl:choose>
														</xsl:when>
														<xsl:when test="Batch__SearchEntity != ''">Search</xsl:when>
														<xsl:when test="Batch__ClientDataOutputSummaryTypeG != ''"><xsl:value-of select="Batch__ClientDataOutputSummaryTypeG" /></xsl:when>
													</xsl:choose>
												</td>

												<!-- Entity type -->
												<td>
													<a href="nds://{Batch__ClientDataOutputSummaryReportName}"><xsl:value-of select="Batch__ClientDataOutputSummaryDescription" /></a>
													<a href="nds://{Batch__ConnectedInstanceIdConverted}"><xsl:value-of select="Batch__ConnectedInstanceEntityName" /></a>
													<xsl:value-of select="Batch__SearchEntityName" />
												</td>

												<!-- Entity ID -->
												<td>
													<xsl:call-template name="Linkify">
														<xsl:with-param name="String">
															<xsl:value-of select="Batch__ClientDataOutputSummaryReportName" />
															<xsl:value-of select="Batch__ConnectedInstanceIdConverted" />
														</xsl:with-param>
													</xsl:call-template>
												</td>

												<!-- Niche ID -->
												<TD>
													<xsl:call-template name="DisplayNicheId">
														<xsl:with-param name="EntityId" select="Batch__ConnectedInstanceIdConverted" />
														<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)" />
													</xsl:call-template>
												</TD>

												<!-- Entity/search info -->
												<td>
													<xsl:call-template name="DisplaySummaryXMLOneLine">
														<xsl:with-param name="InstanceFieldName">Batch__ConnectedInstance</xsl:with-param>
														<xsl:with-param name="EntityFieldName">Batch__ConnectedInstanceEntityName</xsl:with-param>
														<xsl:with-param name="DataRoot" select="." />
													</xsl:call-template>
													<xsl:if test="Batch__SearchEntity != ''">
														<xsl:value-of select="Batch__LabelSearchSpec" />
													</xsl:if>
												</td>

												<!-- Role -->
												<td>
													<xsl:variable name="CurrentRole" select="Batch__EffectiveUserRoleIdConverted" />
													<a href="nds://{Batch__EffectiveUserRoleIdConverted}"><xsl:value-of select="/DATASETLIST/DATASET/ROW[NACRole__Id = $CurrentRole]/NACRole__NameG" /></a>
												</td>

												<!-- Machine -->
												<td>
													<xsl:value-of select="Batch__EffectiveWorkstation" />
													<xsl:if test="Batch__EffectiveWorkstation = ''">
														<xsl:value-of select="Batch__EffectiveIPAddress" />
													</xsl:if>
													<xsl:if test="Batch__EffectiveWorkstation != '' and $ShowIPAddress = '1'">
														<xsl:text> (</xsl:text>
														<xsl:value-of select="Batch__EffectiveIPAddress" />
														<xsl:text>)</xsl:text>
													</xsl:if>
												</td>

												<!-- RFA entry -->
												<td>
													<xsl:value-of select="DATASET/ROW/DATASET/ROW/DATASET/ROW/ALAECSReasonForAccess__Reason" />
												</td>

												<!-- Questionnaire results -->
												<td>
													<xsl:if test="Batch__ClientDataOutputSummaryTypeG = 'Insert' or Batch__ClientDataOutputSummaryTypeG = 'Update'">
														<xsl:value-of select="DATASET/ROW/DATASET/ROW/ALAEInstanceActionData__InstanceSummaryXML/XML/RequestLog/Remarks" />
													</xsl:if>
												</td>
											</tr>
										</xsl:if>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__UpdatedEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Update</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__DeletedEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Delete</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__InsertedEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Insert</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__GetImageEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Binary read</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__SetImageEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Binary write</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__ClientDataOutputSummarySubjectInstanceId" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Entity reference (<xsl:value-of select="Batch__ClientDataOutputSummaryTypeG" />)</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="$InstanceSQLIds" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">SQL entity reference</xsl:with-param>
										</xsl:call-template>

									</xsl:for-each>

								</table>

								</xsl:with-param>
							</xsl:call-template>
						</Data>
					</xsl:template>


					<xsl:template name="ConvertHTMLTableToCSV">
						<xsl:param name="HTMLTable" />
						<Data>
							<xsl:for-each select="msxsl:node-set($HTMLTable)/table|msxsl:node-set($HTMLTable)/TABLE">
								<xsl:for-each select="tr|TR">
									<xsl:for-each select="th|td|TH|TD">
										<!-- Check if it's a number of more than 15 digits (and isn't hyperlinked).  If so, add an '=' in front, so Excel doesn't convert to scientific notation -->
										<!--xsl:if test=". &gt; 0 and string-length(.) &gt; 15 and a/@href = '' and A/@href=''">=</xsl:if-->
										<xsl:call-template name="StuffCSV">
											<xsl:with-param name="ToStuff" select="normalize-space(.)" />
											<xsl:with-param name="HyperlinkId">
												<xsl:value-of select="substring-after(A/@href, 'nds://')" />
												<xsl:value-of select="substring-after(a/@href, 'nds://')" />
											</xsl:with-param>
										</xsl:call-template>
										<xsl:text>,</xsl:text>
									</xsl:for-each>
									<xsl:text>,</xsl:text>
									<xsl:call-template name="PrintNewline" />
								</xsl:for-each>
							</xsl:for-each>
						</Data>
					</xsl:template>


			<xsl:template name="StuffCSV">
				<xsl:param name="ToStuff" />
				<xsl:param name="HyperlinkId" />
				<xsl:param name="RawData" select="'1'" />
				<xsl:choose>
					<xsl:when test="$HyperlinkId != ''">
						<xsl:call-template name="StuffCSV">
							<xsl:with-param name="ToStuff">
								<xsl:text>=HYPERLINK("nds://</xsl:text>
								<xsl:value-of select="$HyperlinkId" />
								<xsl:text>", </xsl:text>
								<xsl:call-template name="StuffCSV"><xsl:with-param name="ToStuff" select="$ToStuff" /><xsl:with-param name="RawData" select="'0'" /></xsl:call-template>
								<xsl:text>)</xsl:text>
							</xsl:with-param>
						</xsl:call-template>
					</xsl:when>
					<xsl:when test="starts-with($ToStuff, '=') and $RawData = '1'">
						<xsl:text>"="</xsl:text>
						<xsl:call-template name="StuffCSV"><xsl:with-param name="ToStuff" select="$ToStuff" /><xsl:with-param name="RawData" select="'0'" /></xsl:call-template>
						<xsl:text>""</xsl:text>
					</xsl:when>
					<xsl:when test="contains($ToStuff, '&quot;')">
						<xsl:call-template name="StuffCSV"><xsl:with-param name="ToStuff" select="substring-before($ToStuff, '&quot;')" /><xsl:with-param name="RawData" select="'0'" /></xsl:call-template>
						<xsl:call-template name="StuffCSV"><xsl:with-param name="ToStuff" select="substring-after($ToStuff, '&quot;')" /><xsl:with-param name="RawData" select="'0'" /></xsl:call-template>
					</xsl:when>
					<xsl:otherwise>
						<xsl:text>"</xsl:text>
						<xsl:value-of select="$ToStuff" />
						<xsl:text>"</xsl:text>
					</xsl:otherwise>
				</xsl:choose>
			</xsl:template>


					<xsl:template name="PrintNewline">
						<xsl:text xml:space="preserve">
</xsl:text>
					</xsl:template>




					<xsl:template name="DisplayRowsForEntityIds">
						<xsl:param name="EntityIds" />
						<xsl:param name="CurrentBatch" />
						<xsl:param name="CurrentBatchPosition" />
						<xsl:param name="TransactionType" />
						<xsl:variable name="Ids">
							<xsl:call-template name="Split">
								<xsl:with-param name="Delimiter">;</xsl:with-param>
								<xsl:with-param name="String" select="$EntityIds" />
							</xsl:call-template>
						</xsl:variable>
						<xsl:for-each select="msxsl:node-set($Ids)/String[text() != '']">
							<xsl:variable name="CurrentId" select="." />
							<tr>
								<xsl:attribute name="style">
									<xsl:choose>
										<xsl:when test="$MarkConfidential = '1' and count(msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]//*[ProtectiveMarkingIsConfidential = 'True']) &gt; 0">
											<xsl:choose>
												<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEB958</xsl:when>
												<xsl:otherwise>background:#FFCA69</xsl:otherwise>
											</xsl:choose>
										</xsl:when>
										<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEEEEE</xsl:when>
										<xsl:otherwise>background:white</xsl:otherwise>
									</xsl:choose>
								</xsl:attribute>

								<!-- Audit ID -->
								<td><a href="nds://{msxsl:node-set($CurrentBatch)/Batch__Id}"><xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__Id" /></a></td>

								<!-- Trans. date/time -->
								<td><xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__FirstALAETimeTZV2GL" /></td>
<!--
								<td><xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__FirstALAETimeOnlyG" /></td>
-->
								<!-- Trans. type -->
								<td><xsl:value-of select="$TransactionType" /></td>

								<xsl:variable name="EntityName">
									<xsl:call-template name="ConvertIdsToEntityNames">
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)" />
										<xsl:with-param name="Ids">
											<String><xsl:value-of select="." /></String>
										</xsl:with-param>
									</xsl:call-template>
									<xsl:if test="starts-with($TransactionType, 'Entity reference')">
										<xsl:call-template name="ConvertIdsToEntityNames">
											<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)" />
											<xsl:with-param name="Ids">
												<String><xsl:value-of select="Batch__ClientDataOutputSummarySubjectInstanceId" /></String>
											</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</xsl:variable>

								<!-- Entity type -->
								<td><a href="nds://{$CurrentId}"><xsl:value-of select="$EntityName" /></a></td>

								<!-- Entity ID -->
								<td><xsl:call-template name="Linkify"><xsl:with-param name="String"><xsl:value-of select="." /></xsl:with-param></xsl:call-template></td>

								<!-- Niche ID -->
								<td>
									<xsl:call-template name="DisplayNicheId">
										<xsl:with-param name="EntityId" select="$CurrentId" />
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW" />
									</xsl:call-template>
								</td>

								<!-- Entity/search info -->
								<td>
									<xsl:call-template name="DisplaySummaryXMLOneLine">
										<xsl:with-param name="InstanceFieldName">ALAEInstanceActionData__Instance</xsl:with-param>
										<xsl:with-param name="EntityFieldName">ALAEInstanceActionData__InstanceIdEntityName</xsl:with-param>
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]" />
									</xsl:call-template>
									<xsl:call-template name="DisplaySummaryXMLOneLine">
										<xsl:with-param name="InstanceFieldName">ALAEClientDataOutput__SubjectInstance</xsl:with-param>
										<xsl:with-param name="EntityFieldName">ALAEClientDataOutput__SubjectInstanceIdEntityName</xsl:with-param>
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW[ALAEClientDataOutput__SubjectInstanceIdConverted = $CurrentId]" />
									</xsl:call-template>
									<xsl:if test="$TransactionType = 'Search'">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__LabelSearchSpec" />
									</xsl:if>
								</td>

								<!-- Role -->
								<td>
									<xsl:variable name="CurrentRole" select="msxsl:node-set($CurrentBatch)/Batch__EffectiveUserRoleIdConverted" />
									<a href="nds://{$CurrentRole}">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/../../DATASET/ROW[NACRole__Id = $CurrentRole]/NACRole__NameG" />
									</a>
								</td>

								<!-- Machine -->
								<td>
									<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__EffectiveWorkstation" />
									<xsl:if test="msxsl:node-set($CurrentBatch)/Batch__EffectiveWorkstation = ''">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__EffectiveIPAddress" />
									</xsl:if>
									<xsl:if test="msxsl:node-set($CurrentBatch)/Batch__EffectiveWorkstation != '' and $ShowIPAddress = '1'">
										<xsl:text> (</xsl:text>
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__EffectiveIPAddress" />
										<xsl:text>)</xsl:text>
									</xsl:if>
								</td>

								<!-- RFA entry -->
								<td><xsl:value-of select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW/DATASET/ROW/ALAECSReasonForAccess__Reason" /></td>

								<!-- Questionnaire results -->
								<td>
									<xsl:if test="($TransactionType = 'Insert' or $TransactionType = 'Update') and $EntityName = 'RequestLog'">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW/ALAEInstanceActionData__InstanceSummaryXML/XML/RequestLog/Remarks" />
									</xsl:if>
								</td>
							</tr>
						</xsl:for-each>
					</xsl:template>


					<xsl:template name="DisplaySummaryXMLOneLine">
						<xsl:param name="InstanceFieldName" />
						<xsl:param name="EntityFieldName" />
						<xsl:param name="DataRoot" />

						<xsl:variable name="RecordIsConfidential" select="msxsl:node-set($DataRoot)/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/ProtectiveMarkingIsConfidential" />
						<xsl:variable name="EntityType" select="msxsl:node-set($DataRoot)/*[name() = $EntityFieldName]" />

						<xsl:if test="string-length($RecordIsConfidential) = 0 or $RecordIsConfidential = 'False' or ($RecordIsConfidential != 'False' and $ShowConfidential = '1')">
							<xsl:choose>
								<!-- Person -->
								<xsl:when test="$EntityType = 'Person'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Surname_cacheG" />
									<xsl:text>, </xsl:text>
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Given1_cache" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Given2_cache" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Given3_cache" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/GenderG" /></String>
										</xsl:with-param>
									</xsl:call-template>
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/DateOfBirth_cacheG != ''">
										<xsl:text> - DOB:</xsl:text>
										<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/DateOfBirth_cacheG" />
									</xsl:if>

								</xsl:when>
								<!-- OrgGeneral/OrgCriminal-->
								<xsl:when test="$EntityType = 'OrgGeneral' or *[name() = $EntityFieldName] = 'OrgCriminal'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/Surname_cacheG" />
								</xsl:when>
								<!-- PhysicalAddress -->
								<xsl:when test="$EntityType = 'PhysicalAddress'">
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/CivicSiteStreetNumberG" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/StreetNameG" /></String>
											<String>
												<xsl:if test="($DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/CivicSiteStreetNumberG&#xD;&#xA;																or $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/StreetNameG)&#xD;&#xA;															and $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/MunicipalityNameG">
													<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/MunicipalityNameG" />
												</xsl:if>
											</String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Telephone -->
								<xsl:when test="$EntityType = 'Telephone' or $EntityType = 'EMail'">
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/Type1G != ''">
										<xsl:text>(</xsl:text>
										<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/Type1G" />
										<xsl:text>) </xsl:text>
									</xsl:if>
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/CommAddressG" />
								</xsl:when>
								<!-- Occurrence -->
								<xsl:when test="$EntityType = 'Occurrence'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceFileNoG" />
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceFileNoG != ''&#xD;&#xA;												and $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceStdOccTypeRId_L != ''">
										<xsl:text> - </xsl:text>
									</xsl:if>
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceStdOccTypeRId_L" />
								</xsl:when>
								<!-- SCOccurrence -->
								<xsl:when test="$EntityType = 'SCOccurrence'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/OccurrenceFileNoG" />
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/OccurrenceFileNoG != ''&#xD;&#xA;												and $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/ClassificationG != ''">
										<xsl:text> - </xsl:text>
									</xsl:if>
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/ClassificationG" />
								</xsl:when>
								<!-- GPersonArrest -->
								<xsl:when test="$EntityType = 'GPersonArrest'">
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> - </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonArrest/LabelCustodyNumberG" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonArrest/LabelPersonFull" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonArrest/GPCStdReasonRId_L" /></String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- GPersonCharge -->
								<xsl:when test="$EntityType = 'GPersonCharge'">
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> - </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonCharge/OffenseDate1G" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonCharge/OffenseDate2G" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonCharge/GPChargeStdChargeRId_L" /></String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Default -->
								<!-- Includes CourtFolder, Report entities, Vehicle, PersonDescImage, and anything else not listed above -->
								<xsl:otherwise>
									<xsl:call-template name="DisplayFirstNonEmptyString">
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/Label" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelAssoc" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelAudit" /></String>
											<String>
												<xsl:call-template name="ComposeWith">
													<xsl:with-param name="Separator">-</xsl:with-param>
													<xsl:with-param name="Strings">
														<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelLeft" /></String>
														<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelRight" /></String>
													</xsl:with-param>
												</xsl:call-template>
											</String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:otherwise>
							</xsl:choose>
						</xsl:if>

					</xsl:template>


					<xsl:template name="DisplayFirstNonEmptyString" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
						<xsl:param name="Strings" />
						<xsl:choose>
							<xsl:when test="count(msxsl:node-set($Strings)/String) = 0" />
							<xsl:when test="msxsl:node-set($Strings)/String[1] != ''"><xsl:value-of select="msxsl:node-set($Strings)/String[1]" /></xsl:when>
							<xsl:otherwise>
								<xsl:call-template name="DisplayFirstNonEmptyString">
									<xsl:with-param name="Strings">
										<xsl:for-each select="msxsl:node-set($Strings)/String[position() != 1]">
											<String><xsl:value-of select="." /></String>
										</xsl:for-each>
									</xsl:with-param>
								</xsl:call-template>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:template>



					<xsl:template name="Linkify">
						<xsl:param name="String" />
						<xsl:param name="Position">1</xsl:param>

						<xsl:if test="string-length($String) = 0"><xsl:text> </xsl:text></xsl:if>

						<xsl:if test="$Position &lt;= string-length($String)">

							<xsl:variable name="Digits">
								<xsl:call-template name="DigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position" />
								</xsl:call-template>
							</xsl:variable>

							<xsl:variable name="NonDigits">
								<xsl:call-template name="NonDigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position" />
								</xsl:call-template>
							</xsl:variable>

							<xsl:choose>
								<xsl:when test="$Digits &gt;= 23 and $Digits &lt;= 25">
									<xsl:variable name="Id" select="substring($String, $Position, $Digits)" />
									<a href="nds://{$Id}"><xsl:value-of select="$Id" /></a>
									<xsl:call-template name="Linkify">
										<xsl:with-param name="String" select="$String" />
										<xsl:with-param name="Position" select="$Position + $Digits" />
									</xsl:call-template>
								</xsl:when>
								<xsl:when test="$Digits &gt; 0">
									<xsl:value-of select="substring($String, $Position, $Digits)" />
									<xsl:call-template name="Linkify">
										<xsl:with-param name="String" select="$String" />
										<xsl:with-param name="Position" select="$Position + $Digits" />
									</xsl:call-template>
								</xsl:when>
								<xsl:otherwise>
									<xsl:value-of select="substring($String, $Position, $NonDigits)" />
									<xsl:call-template name="Linkify">
										<xsl:with-param name="String" select="$String" />
										<xsl:with-param name="Position" select="$Position + $NonDigits" />
									</xsl:call-template>
								</xsl:otherwise>
							</xsl:choose>

						</xsl:if>

					</xsl:template>


					<xsl:template name="DigitsFromPosition">
						<xsl:param name="String" />
						<xsl:param name="Position" />
						<xsl:param name="DigitsSoFar">0</xsl:param>

						<xsl:choose>
							<xsl:when test="$Position &gt; string-length($String)">
								<xsl:value-of select="$DigitsSoFar" />
							</xsl:when>
							<xsl:when test="number(substring($String, $Position, 1)) &gt; -1">
								<xsl:call-template name="DigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position + 1" />
									<xsl:with-param name="DigitsSoFar" select="$DigitsSoFar + 1" />
								</xsl:call-template>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="$DigitsSoFar" />
							</xsl:otherwise>
						</xsl:choose>

					</xsl:template>


					<xsl:template name="NonDigitsFromPosition">
						<xsl:param name="String" />
						<xsl:param name="Position" />
						<xsl:param name="NonDigitsSoFar">0</xsl:param>

						<xsl:choose>
							<xsl:when test="$Position &gt; string-length($String)">
								<xsl:value-of select="$NonDigitsSoFar" />
							</xsl:when>
							<xsl:when test="not(number(substring($String, $Position, 1)) &gt; -1)">
								<xsl:call-template name="NonDigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position + 1" />
									<xsl:with-param name="NonDigitsSoFar" select="$NonDigitsSoFar + 1" />
								</xsl:call-template>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="$NonDigitsSoFar" />
							</xsl:otherwise>
						</xsl:choose>

					</xsl:template>


					<xsl:template name="ConvertIdsToEntityNames">
						<xsl:param name="DataRoot" />
						<xsl:param name="Ids" />
						<xsl:for-each select="msxsl:node-set($Ids)/String[text() != '']">
							<xsl:variable name="CurrentId" select="." />
							<xsl:if test="count(msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]) &gt; 0">
								<a href="nds://{$CurrentId}">
									<xsl:value-of select="msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]/ALAEInstanceActionData__InstanceIdEntityName" />
								</a>
								<xsl:if test="position() != last()">
									<xsl:text>, </xsl:text>
								</xsl:if>
							</xsl:if>
							<xsl:if test="count(msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEClientDataOutput__SubjectInstanceIdConverted = $CurrentId]) &gt; 0">
								<a href="nds://{$CurrentId}">
									<xsl:value-of select="msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEClientDataOutput__SubjectInstanceIdConverted = $CurrentId]/ALAEClientDataOutput__SubjectInstanceIdDisplayName" />
								</a>
								<xsl:if test="position() != last()">
									<xsl:text>, </xsl:text>
								</xsl:if>
							</xsl:if>
						</xsl:for-each>
					</xsl:template>


				<xsl:template name="Split">
					<xsl:param name="String" />
					<xsl:param name="Delimiter" select="';'" />
					<xsl:param name="DiscardBlank" select="'0'" />

					<xsl:choose>
						<xsl:when test="not(contains($String, $Delimiter))">
							<xsl:if test="$String != '' or $DiscardBlank = '0'">
								<String><xsl:value-of select="$String" /></String>
							</xsl:if>
						</xsl:when>
						<xsl:otherwise>
							<xsl:if test="$DiscardBlank = '0' or ($DiscardBlank = '1' and substring-before($String, $Delimiter) != '')">
								<String><xsl:value-of select="substring-before($String, $Delimiter)" /></String>
							</xsl:if>
							<xsl:call-template name="Split">
								<xsl:with-param name="String" select="substring-after($String, $Delimiter)" />
								<xsl:with-param name="Delimiter" select="$Delimiter" />
								<xsl:with-param name="DiscardBlank" select="$DiscardBlank" />
							</xsl:call-template>
						</xsl:otherwise>
					</xsl:choose>

				</xsl:template>


				<xsl:template name="ComposeWith" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
					<xsl:param name="Strings" />
					<xsl:param name="Separator">
						<xsl:text> / </xsl:text>
					</xsl:param>
					<xsl:for-each select="msxsl:node-set($Strings)/String">
						<xsl:if test="string-length(text()) &gt; 0 and count(preceding-sibling::String[string-length(.) &gt; 0]) &gt; 0">
							<xsl:value-of select="$Separator" />
						</xsl:if>
						<xsl:value-of select="./text()" />
					</xsl:for-each>
				</xsl:template>


					<!-- StyleClasses template -->
					<xsl:template name="StyleClasses">
						<xsl:element name="style">
							<xsl:attribute name="type">text/css</xsl:attribute>
							<xsl:text>


								BODY		{ font-size: 10pt; font-family:Arial; vertical-align:top; }
								H2			{ font-size: 12pt; font-style: italic; font-weight: bold; }
								H3			{ font-size: 10pt; font-style: italic; font-weight: bold; }
								H6			{ font-size: 8pt; font-weight:bold; margin-top:-10pt; text-align:center; }
								TH			{ text-align:left; border-color: silver; border-style: none none solid none; border-width:2px; font-size: 7pt; font-style: italic; vertical-align: bottom; }
								TABLE		{ font-size: 10pt; }

								TABLE.GridLayout	{ width:100%; font-size: 7pt; padding: 0px 2px 0px 2px; vertical-align: top; }
								HR.separator		{ display:none; }
								H1.TitleForeground	{ font-size: 16pt; font-weight: bold; margin-top:-20pt; text-align: center; border:solid black; border-width:2px 0 2px 0; }

								.TitleBackground	{ margin:0pt; border-top-width:19pt; border-style:solid; border-bottom-width:0pt; border-color:silver; display:block }




							.				{ font-size: 10pt; font-family: Arial; vertical-align:top; }
							.Data			{ font-size: 10pt; font-style: normal; }
							.Label			{ font-size: 10pt; font-style: italic; padding-left:0.2cm; vertical-align:top }
							.PrintedLabel	{ font-size:8pt; }
							.ReportHeader	{ font-size: 16pt; font-weight: bold; margin-top:-17pt; text-align: center; }
							.ReportHeader2	{ font-size: 12pt; font-style: italic; font-weight: bold; }
							.ReportHeader3	{ font-size: 10pt; font-style: italic; font-weight: bold; }
							.RestrictedUseLabel { font-style: italic; font-weight: bold; }
							.SilverLine		{ border-top: solid; border-top-width: 2px; border-color: silver; }
							.TableData		{ font-size: 7pt; padding: 0px 2px 0px 2px; vertical-align: top; }
							.TableHeader	{ border-color: silver; border-style: none none solid none; border-width:2px; font-size: 7pt; font-style: italic; vertical-align: bottom; }

							DIV.Data		{ display:inline; }
							DIV.Label		{ display:inline; font-weight: bold; width:18%; }
							DIV.DataItem	{ vertical-align:none; width:100%; }
							H2				{ font-size:12pt; }
							H3				{ font-size:10pt; }
							A				{ font-size:7pt;text-decoration:none; }
							TD				{ font-size:7pt; }
							LI				{ font-size:7pt; }
							</xsl:text>
						</xsl:element>
					</xsl:template>


				<!-- Title template -->
				<xsl:template name="Title" xmlns:pp="urn:nichePreprocessor">
					<xsl:param name="Text" />
					<span id="Title">
						<div class="TitleBackground"> </div>
						<h1 class="TitleForeground"><xsl:value-of select="$Text" /></h1>


					</span>
				</xsl:template>


			<!-- InfoBox template -->
				<xsl:template name="InfoBox" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:nl="urn:nicheLanguage" xmlns:pp="urn:nichePreprocessor">
					<xsl:param name="DataNodes" />
					<xsl:param name="SpecDesc" />
					<xsl:param name="ShowPrintedByUser">1</xsl:param>
					<xsl:param name="ShowTimestamp">1</xsl:param>
					<xsl:param name="ShowAgencyAndDivision">1</xsl:param>
					<xsl:param name="ShowInfoBoxBorder">1</xsl:param>
					<xsl:param name="ShowPoliceId1Label">0</xsl:param>
					<xsl:param name="UseCurEmpNumberInsteadOfCurrUser">0</xsl:param>

					<span id="InfoBox">
						<xsl:variable name="BorderStyle">
							<xsl:if test="$ShowInfoBoxBorder = 1">border-style:solid;border-width:1px;</xsl:if>
						</xsl:variable>
						<div style="{$BorderStyle}">
							<xsl:if test="$ShowAgencyAndDivision = '1' or $ShowPoliceId1Label = '1'">
								<div style="margin-bottom:0.2cm; padding: .25cm;">
									<xsl:variable name="AgencyName"><xsl:value-of select="/DATASETLIST/DATASET/ROW/AgencyName" /></xsl:variable>
									<xsl:variable name="DivisionName"><xsl:value-of select="/DATASETLIST/DATASET/ROW/DivisionName" /></xsl:variable>
									<xsl:if test="$ShowAgencyAndDivision = '1'">
										<xsl:value-of select="$AgencyName" />
										<xsl:if test="string-length($AgencyName) &gt; 0 and string-length($DivisionName) &gt; 0"><xsl:text>, </xsl:text></xsl:if>
										<xsl:value-of select="$DivisionName" />
									</xsl:if>
									<xsl:if test="$ShowPoliceId1Label = '1'">
										<xsl:variable name="PoliceId1Label">
											<xsl:choose>
												<xsl:when test="/DATASETLIST/DATASET/ROW/PoliceId1Label != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/PoliceId1Label" />
												</xsl:when>
												<xsl:otherwise>
													<nl:mls><e>MNI:</e><f>MNI:</f><u>MNI:</u><a>MNI:</a><s>MNI:</s></nl:mls>
												</xsl:otherwise>
											</xsl:choose>
										</xsl:variable>
										<xsl:if test="string-length($PoliceId1Label) &gt; 0">
											<xsl:if test="$ShowAgencyAndDivision = '1' and (string-length($AgencyName) &gt; 0 or string-length($DivisionName) &gt; 0)"><xsl:text>, </xsl:text></xsl:if>
											<xsl:value-of select="$PoliceId1Label" />
										</xsl:if>
									</xsl:if>
								</div>
							</xsl:if>
							<xsl:if test="count(msxsl:node-set($DataNodes)/row) &gt; 0">
								<table width="97%" align="center" style="border:none">
									<colgroup>
										<col class="Label" width="21%" />
										<col width="79%" />
									</colgroup>
									<xsl:for-each select="msxsl:node-set($DataNodes)/row">
										<xsl:call-template name="InfoBoxLine">
											<xsl:with-param name="Label" select="label" />
											<xsl:with-param name="Data" select="value" />
											<xsl:with-param name="BoldLabel" select="label/@bold" />
											<xsl:with-param name="BoldData" select="value/@bold" />
										</xsl:call-template>
									</xsl:for-each>
								</table>
								<BR />
							</xsl:if>
							<xsl:if test="$ShowPrintedByUser = '1' or $ShowTimestamp = '1' or string-length($SpecDesc) &gt; 0">
								<div>
									<table width="97%" align="left" cellpadding="0" cellspacing="0" style="border:none">
										<tr>
											<td width="49%" class="PrintedLabel" style="vertical-align:bottom; border:none;">
												<xsl:if test="$ShowTimestamp = '1'">
													<xsl:text><nl:mls><e>Valid as of </e><f>Valide  partir de </f></nl:mls></xsl:text>
													<xsl:choose>
														<xsl:when test="/DATASETLIST/DATASET/ROW/DataTimestamp != ''">
															<xsl:value-of select="/DATASETLIST/DATASET/ROW/DataTimestamp" />
														</xsl:when>
														<xsl:otherwise>
															&lt;<xsl:text><nl:mls><e>Unknown</e><f>Inconnu</f></nl:mls></xsl:text>&gt;
														</xsl:otherwise>
													</xsl:choose>
												</xsl:if>
												<xsl:if test="$ShowPrintedByUser = '1'">
													<br />
													<xsl:text><nl:mls><e>Printed by </e><f>Imprim par </f></nl:mls></xsl:text>
													<xsl:choose>
														<xsl:when test="$UseCurEmpNumberInsteadOfCurrUser = '1'">
															<xsl:value-of select="/DATASETLIST/DATASET/ROW/CurrentEmployeeNumber" />
														</xsl:when>
														<xsl:otherwise>
															<xsl:value-of select="/DATASETLIST/DATASET/ROW/CurrentUser" />
														</xsl:otherwise>
													</xsl:choose>
												</xsl:if>
											</td>
											<td width="2%" style="border:none" />
											<td width="49%" class="PrintedLabel" style="vertical-align:bottom;text-align:right;border:none">
												<xsl:if test="string-length($SpecDesc) &gt; 0">
													<xsl:text><nl:mls><e>Summary for: </e><f>Sommaire pour: </f></nl:mls></xsl:text><xsl:value-of select="$SpecDesc" />
												</xsl:if>
											</td>
										</tr>
									</table>
								</div>
							</xsl:if>
						</div>
						<br />
					</span>
					<br />
				</xsl:template>

			<!-- InfoBoxLine template -->
				<xsl:template name="InfoBoxLine">
					<xsl:param name="Label" />
					<xsl:param name="Data" />
					<xsl:param name="BoldLabel">0</xsl:param>
					<xsl:param name="BoldData">0</xsl:param>
					<xsl:if test="$Label != '' or $Data != ''">
						<xsl:variable name="LabelStyle">
							<xsl:if test="$BoldLabel = 1">font-weight:bold;</xsl:if>
							<xsl:text>border:none;</xsl:text>
						</xsl:variable>
						<xsl:variable name="DataStyle">
							<xsl:if test="$BoldData = 1">font-weight:bold;</xsl:if>
							<xsl:text>border:none;</xsl:text>
						</xsl:variable>

						<tr>
							<td style="{$LabelStyle}">
								<xsl:value-of select="$Label" />
							</td>
							<td style="{$DataStyle}">
								<xsl:copy-of select="$Data" />
							</td>
						</tr>
					</xsl:if>
				</xsl:template>


  				<xsl:template name="DisplayNicheId">
						<xsl:param name="EntityId" />
						<xsl:param name="DataRoot" />

						<xsl:variable name="EntityNumber" select="substring($EntityId, 1, string-length($EntityId) - 20)" />
						<a href="nds://{$EntityId}">
							<xsl:choose>
								<!-- GOccurrence -->
								<xsl:when test="$EntityNumber = '903' or $EntityNumber = '901'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">OccurrenceFileNoG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Person -->
								<xsl:when test="$EntityNumber = '1500'">
									<xsl:call-template name="DisplayFirstNonEmptyString">
										<xsl:with-param name="Strings">
											<String>
												<xsl:call-template name="DisplayNicheIdForEntityType">
													<xsl:with-param name="DataRoot" select="$DataRoot" />
													<xsl:with-param name="EntityId" select="$EntityId" />
													<xsl:with-param name="NicheIdField">EmployeeNumber_cache</xsl:with-param>
												</xsl:call-template>
											</String>
											<String>
												<xsl:call-template name="DisplayNicheIdForEntityType">
													<xsl:with-param name="DataRoot" select="$DataRoot" />
													<xsl:with-param name="EntityId" select="$EntityId" />
													<xsl:with-param name="NicheIdField">PoliceId1_cache</xsl:with-param>
												</xsl:call-template>
											</String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Organization -->
								<xsl:when test="$EntityNumber = '1401' or $EntityNumber = '1402'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">EmployeeNumber_cache</xsl:with-param>
									</xsl:call-template>
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">PoliceId1_cache</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- CourtFolder -->
								<xsl:when test="$EntityNumber = '2000'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">IdNumberG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- GPersonArrest -->
								<xsl:when test="$EntityNumber = '1206'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">LabelCustodyNumberG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Task -->
								<xsl:when test="$EntityNumber = '10501'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">TaskNumberG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
							</xsl:choose>
						</a>
					</xsl:template>

					<xsl:template name="DisplayNicheIdForEntityType">
						<xsl:param name="DataRoot" />
						<xsl:param name="EntityId" />
						<xsl:param name="NicheIdField" />

						<xsl:value-of select="msxsl:node-set($DataRoot)[ALAEInstanceActionData__InstanceIdConverted = $EntityId]/ALAEInstanceActionData__InstanceSummaryXML/XML/*/*[name() = $NicheIdField]" />
						<xsl:value-of select="msxsl:node-set($DataRoot)[ALAEClientDataOutput__SubjectInstanceIdConverted = $EntityId]/ALAEClientDataOutput__SubjectInstanceSummaryXML/XML/*/*[name() = $NicheIdField]" />
						<xsl:value-of select="msxsl:node-set($DataRoot)[Batch__ConnectedInstanceIdConverted = $EntityId][Batch__ConnectedInstanceIdConverted = $EntityId]/Batch__ConnectedInstanceSummaryXML/XML/*/*[name() = $NicheIdField]" />
					</xsl:template>


				</xsl:stylesheet>]]>
		</XSLT>
	</Report>

	<Report>
		<FileType>HTML</FileType>
		<FileExtension>htm</FileExtension>
		<AllowPrint>1</AllowPrint>
		<AllowSave>1</AllowSave>
		<AllowPrintPreview>1</AllowPrintPreview>
		<AllowPagedPreview>1</AllowPagedPreview>
		<AllowEmail>1</AllowEmail>
		<XSLT>
			<![CDATA[<?xml version="1.0" encoding="Windows-1252"?>
				<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:nicheFunctions="urn:nicheFunctions" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
					<xsl:param name="StartTimeG" />
					<xsl:param name="EndTimeG" />
					<xsl:param name="ShowConfidential" />
					<xsl:param name="MarkConfidential" />
					<xsl:param name="ReportPurpose" />
					<xsl:param name="RecipientName" />
					<xsl:param name="RecipientUnit" />
					<xsl:param name="RecipientTelephone" />
					<xsl:param name="TransactionTypeG" />
					<xsl:param name="ShowFailedLogons" />
					<xsl:param name="ShowIPAddress" />
					<xsl:param name="EntitiesG" />

					<xsl:output method="xml" indent="yes" omit-xml-declaration="yes" />

					<xsl:template match="/">
						<HTML>
							<xsl:variable name="ReportTitle">Employee audit report</xsl:variable>
							<xsl:element name="title"><xsl:value-of select="$ReportTitle" /></xsl:element>

							<!-- Insert the style class declarations -->
							<xsl:call-template name="StyleClasses" />

							<xsl:element name="BODY">
								<!-- Insert the title-->
								<xsl:call-template name="Title">
									<xsl:with-param name="Text" select="$ReportTitle" />
								</xsl:call-template>

								<!-- Insert the info box -->
								<xsl:call-template name="InfoBox">
									<xsl:with-param name="DataNodes">
										<row>
											<label>Report purpose:</label>
											<value bold="1"><xsl:value-of select="$ReportPurpose" /></value>
										</row>
										<row>
											<label>Recipient:</label>
											<value bold="1"><xsl:value-of select="$RecipientName" /></value>
										</row>
										<row>
											<label>Recipient unit:</label>
											<value bold="1"><xsl:value-of select="$RecipientUnit" /></value>
										</row>
										<row>
											<label>Recipient telephone:</label>
											<value bold="1"><xsl:value-of select="$RecipientTelephone" /></value>
										</row>
										<row>
											<label>Protective marking:</label>
											<value bold="1">
												<xsl:choose>
													<xsl:when test="count(//*[ProtectiveMarkingIsConfidential = 'True']) &gt; 0">CONFIDENTIAL</xsl:when>
													<xsl:otherwise>RESTRICTED</xsl:otherwise>
												</xsl:choose>
											</value>
										</row>
										<row>
											<label>Start date:</label>
											<value><xsl:value-of select="$StartTimeG" /></value>
										</row>
										<row>
											<label>End date:</label>
											<value><xsl:value-of select="$EndTimeG" /></value>
										</row>
										<row>
											<label>Report subject:</label>
											<value bold="1">
												<!-- EmployeeNumber -->
												<xsl:if test="/DATASETLIST/DATASET/ROW/Person__EmployeeNumber_cache != ''">
													<xsl:text>#</xsl:text>
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/Person__EmployeeNumber_cache" />
													<xsl:text> </xsl:text>
												</xsl:if>

												<!-- Name -->
												<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonName__DistinctTitleG != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonName__DisctinctTitleG" />
													<xsl:text> </xsl:text>
												</xsl:if>
												<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonName__SurnameStore != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonName__SurnameStore" />
													<xsl:text>, </xsl:text>
												</xsl:if>
												<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonName__Given1 != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonName__Given1" />
													<xsl:text> </xsl:text>
												</xsl:if>
												<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonName__Given2 != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonName__Given2" />
													<xsl:text> </xsl:text>
												</xsl:if>
												<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonName__Given3 != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonName__Given3" />
													<xsl:text> </xsl:text>
												</xsl:if>

												<!-- User ID -->
												<xsl:if test="/DATASETLIST/DATASET/ROW/Person__UserId != ''">
													<xsl:text>(</xsl:text>
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/Person__UserId" />
													<xsl:text>) </xsl:text>
												</xsl:if>

												<!-- Org membership -->
												<xsl:if test="/DATASETLIST/DATASET/ROW/OrgPolice__Surname_cacheG != ''">
													<xsl:text>(Member of </xsl:text>
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/OrgPolice__Surname_cacheG" />
													<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveFromTimeDG != '' and /DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveToTimeDG != ''">
														<xsl:text> from </xsl:text>
														<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveFromTimeDG" />
														<xsl:text> to </xsl:text>
														<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveToTimeDG" />
													</xsl:if>
													<xsl:if test="/DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveFromTimeDG != '' and /DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveToTimeDG = ''">
														<xsl:text> since </xsl:text>
														<xsl:value-of select="/DATASETLIST/DATASET/ROW/GPersonOrgMemberGPerson__EffectiveFromTimeDG" />
													</xsl:if>
													<xsl:text>)</xsl:text>
												</xsl:if>
											</value>
										</row>
										<row>
											<label>Entities selected:</label>
											<value><xsl:value-of select="$EntitiesG" /></value>
										</row>
										<row>
											<label>Transaction types:</label>
											<value><xsl:value-of select="$TransactionTypeG" /></value>
										</row>
									</xsl:with-param>
								</xsl:call-template>

								<!-- Report body -->

								<!-- Failed log-on attempts -->
								<xsl:if test="$ShowFailedLogons = '1'">
									<h2>Failed log-on attempts</h2>
									<xsl:choose>
										<xsl:when test="count(/DATASETLIST/DATASET/ROW[FailedLogon__Id]) &gt; 0">
											<table width="50%">
												<tr>
													<th align="left">User ID</th>
													<th align="left">Workstation</th>
													<th align="left">IP address</th>
													<th align="left">Time</th>
												</tr>
												<xsl:for-each select="/DATASETLIST/DATASET/ROW[FailedLogon__Id]">
													<tr>
														<xsl:attribute name="style">
															<xsl:choose>
																<xsl:when test="position() mod 2 = 1">background:#EEEEEE</xsl:when>
																<xsl:otherwise>background:white</xsl:otherwise>
															</xsl:choose>
														</xsl:attribute>
														<td><xsl:value-of select="FailedLogon__LoginUserId" /></td>
														<td><xsl:value-of select="FailedLogon__InitialWorkstation" /></td>
														<td><xsl:value-of select="FailedLogon__InitialIPAddress" /></td>
														<td><xsl:value-of select="FailedLogon__StartTimeTZV2GL" /></td>
													</tr>
												</xsl:for-each>
											</table>
										</xsl:when>
										<xsl:otherwise>No failed log-on attempts found</xsl:otherwise>
									</xsl:choose>
									<br />
									<br />
								</xsl:if>


								<table>
									<tr>
									<th>Audit ID</th>
<!--
									<th>Trans. date</th>
									<th>Trans. time</th>
-->
									<th>Trans. date/time</th>
									<th>Trans. type</th>
									<th>Entity type</th>
									<th>Entity ID</th>
									<th>Niche ID</th>
									<th>Entity/search info</th>
									<th>Role</th>
									<th>Machine</th>
									<th>RFA entry</th>
									<th>Questionnaire results</th>
									</tr>

									<xsl:for-each select="/DATASETLIST/DATASET/ROW[Batch__Id]">

										<xsl:variable name="CurrentBatch" select="." />
										<xsl:variable name="CurrentBatchPosition" select="position()" />

										<xsl:variable name="InstanceSQLIds">
											<xsl:call-template name="ComposeWith">
												<xsl:with-param name="Separator">;</xsl:with-param>
												<xsl:with-param name="Strings">
													<xsl:for-each select="DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__EntityName = 'ALAEInstanceSQL']">
														<String><xsl:value-of select="ALAEInstanceActionData__InstanceIdConverted" /></String>
													</xsl:for-each>
												</xsl:with-param>
											</xsl:call-template>
										</xsl:variable>

										<tr><td colspan="100" style="height:1px;background:#888888"><xsl:text> </xsl:text></td></tr>

										<xsl:if test="Batch__ConnectedInstanceIdConverted != '' or Batch__ClientDataOutputSummaryTypeG != '' or Batch__SearchEntity != ''">
											<tr>
												<xsl:attribute name="style">
													<xsl:choose>
														<xsl:when test="$MarkConfidential = '1' and count(msxsl:node-set($CurrentBatch)//*[ProtectiveMarkingIsConfidential = 'True']) &gt; 0">
															<xsl:choose>
																<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEB958;border-color:#EEB958;</xsl:when>
																<xsl:otherwise>background:#FFCA69;border-color:#FFCA69;</xsl:otherwise>
															</xsl:choose>
														</xsl:when>
														<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEEEEE;border-color:#EEEEEE;</xsl:when>
														<xsl:otherwise>background:white;border-color:white;</xsl:otherwise>
													</xsl:choose>
												</xsl:attribute>

												<!-- Audit ID -->
												<td><a href="nds://{Batch__Id}"><xsl:value-of select="Batch__Id" /></a></td>

												<!-- Trans. date -->
												<td><xsl:value-of select="Batch__FirstALAETimeTZV2GL" /></td>

												<!-- Trans. time -->
<!--
												<td><xsl:value-of select="Batch__FirstALAETimeOnlyG" /></td>
-->
												<!-- Trans. type -->
												<td>
													<xsl:choose>
														<xsl:when test="Batch__ConnectedInstanceIdConverted != ''">
															<xsl:choose>
																<xsl:when test="Batch__ConnectedWindow = 'w_appcontrolrms'">Open RMS launchpad</xsl:when>
																<xsl:otherwise>Open window</xsl:otherwise>
															</xsl:choose>
														</xsl:when>
														<xsl:when test="Batch__SearchEntity != ''">Search</xsl:when>
														<xsl:when test="Batch__ClientDataOutputSummaryTypeG != ''"><xsl:value-of select="Batch__ClientDataOutputSummaryTypeG" /></xsl:when>
													</xsl:choose>
												</td>

												<!-- Entity type -->
												<td>
													<a href="nds://{Batch__ClientDataOutputSummaryReportName}"><xsl:value-of select="Batch__ClientDataOutputSummaryDescription" /></a>
													<a href="nds://{Batch__ConnectedInstanceIdConverted}"><xsl:value-of select="Batch__ConnectedInstanceEntityName" /></a>
													<xsl:value-of select="Batch__SearchEntityName" />
												</td>

												<!-- Entity ID -->
												<td>
													<xsl:call-template name="Linkify">
														<xsl:with-param name="String">
															<xsl:value-of select="Batch__ClientDataOutputSummaryReportName" />
															<xsl:value-of select="Batch__ConnectedInstanceIdConverted" />
														</xsl:with-param>
													</xsl:call-template>
												</td>

												<!-- Niche ID -->
												<TD>
													<xsl:call-template name="DisplayNicheId">
														<xsl:with-param name="EntityId" select="Batch__ConnectedInstanceIdConverted" />
														<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)" />
													</xsl:call-template>
												</TD>

												<!-- Entity/search info -->
												<td>
													<xsl:call-template name="DisplaySummaryXMLOneLine">
														<xsl:with-param name="InstanceFieldName">Batch__ConnectedInstance</xsl:with-param>
														<xsl:with-param name="EntityFieldName">Batch__ConnectedInstanceEntityName</xsl:with-param>
														<xsl:with-param name="DataRoot" select="." />
													</xsl:call-template>
													<xsl:if test="Batch__SearchEntity != ''">
														<xsl:value-of select="Batch__LabelSearchSpec" />
													</xsl:if>
												</td>

												<!-- Role -->
												<td>
													<xsl:variable name="CurrentRole" select="Batch__EffectiveUserRoleIdConverted" />
													<a href="nds://{Batch__EffectiveUserRoleIdConverted}"><xsl:value-of select="/DATASETLIST/DATASET/ROW[NACRole__Id = $CurrentRole]/NACRole__NameG" /></a>
												</td>

												<!-- Machine -->
												<td>
													<xsl:value-of select="Batch__EffectiveWorkstation" />
													<xsl:if test="Batch__EffectiveWorkstation = ''">
														<xsl:value-of select="Batch__EffectiveIPAddress" />
													</xsl:if>
													<xsl:if test="Batch__EffectiveWorkstation != '' and $ShowIPAddress = '1'">
														<xsl:text> (</xsl:text>
														<xsl:value-of select="Batch__EffectiveIPAddress" />
														<xsl:text>)</xsl:text>
													</xsl:if>
												</td>

												<!-- RFA entry -->
												<td>
													<xsl:value-of select="DATASET/ROW/DATASET/ROW/DATASET/ROW/ALAECSReasonForAccess__Reason" />
												</td>

												<!-- Questionnaire results -->
												<td>
													<xsl:if test="Batch__ClientDataOutputSummaryTypeG = 'Insert' or Batch__ClientDataOutputSummaryTypeG = 'Update'">
														<xsl:value-of select="DATASET/ROW/DATASET/ROW/ALAEInstanceActionData__InstanceSummaryXML/XML/RequestLog/Remarks" />
													</xsl:if>
												</td>
											</tr>
										</xsl:if>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__UpdatedEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Update</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__DeletedEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Delete</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__InsertedEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Insert</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__GetImageEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Binary read</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__SetImageEntities" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Binary write</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="Batch__ClientDataOutputSummarySubjectInstanceId" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">Entity reference (<xsl:value-of select="Batch__ClientDataOutputSummaryTypeG" />)</xsl:with-param>
										</xsl:call-template>

										<xsl:call-template name="DisplayRowsForEntityIds">
											<xsl:with-param name="EntityIds" select="$InstanceSQLIds" />
											<xsl:with-param name="CurrentBatch" select="$CurrentBatch" />
											<xsl:with-param name="CurrentBatchPosition" select="$CurrentBatchPosition" />
											<xsl:with-param name="TransactionType">SQL entity reference</xsl:with-param>
										</xsl:call-template>

									</xsl:for-each>

								</table>


							</xsl:element>
						</HTML>
					</xsl:template>


					<xsl:template name="DisplayRowsForEntityIds">
						<xsl:param name="EntityIds" />
						<xsl:param name="CurrentBatch" />
						<xsl:param name="CurrentBatchPosition" />
						<xsl:param name="TransactionType" />
						<xsl:variable name="Ids">
							<xsl:call-template name="Split">
								<xsl:with-param name="Delimiter">;</xsl:with-param>
								<xsl:with-param name="String" select="$EntityIds" />
							</xsl:call-template>
						</xsl:variable>
						<xsl:for-each select="msxsl:node-set($Ids)/String[text() != '']">
							<xsl:variable name="CurrentId" select="." />
							<tr>
								<xsl:attribute name="style">
									<xsl:choose>
										<xsl:when test="$MarkConfidential = '1' and count(msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]//*[ProtectiveMarkingIsConfidential = 'True']) &gt; 0">
											<xsl:choose>
												<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEB958</xsl:when>
												<xsl:otherwise>background:#FFCA69</xsl:otherwise>
											</xsl:choose>
										</xsl:when>
										<xsl:when test="$CurrentBatchPosition mod 2 = 1">background:#EEEEEE</xsl:when>
										<xsl:otherwise>background:white</xsl:otherwise>
									</xsl:choose>
								</xsl:attribute>

								<!-- Audit ID -->
								<td><a href="nds://{msxsl:node-set($CurrentBatch)/Batch__Id}"><xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__Id" /></a></td>

								<!-- Trans. date/time -->
								<td><xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__FirstALAETimeTZV2GL" /></td>
<!--
								<td><xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__FirstALAETimeOnlyG" /></td>
-->
								<!-- Trans. type -->
								<td><xsl:value-of select="$TransactionType" /></td>

								<xsl:variable name="EntityName">
									<xsl:call-template name="ConvertIdsToEntityNames">
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)" />
										<xsl:with-param name="Ids">
											<String><xsl:value-of select="." /></String>
										</xsl:with-param>
									</xsl:call-template>
									<xsl:if test="starts-with($TransactionType, 'Entity reference')">
										<xsl:call-template name="ConvertIdsToEntityNames">
											<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)" />
											<xsl:with-param name="Ids">
												<String><xsl:value-of select="Batch__ClientDataOutputSummarySubjectInstanceId" /></String>
											</xsl:with-param>
										</xsl:call-template>
									</xsl:if>
								</xsl:variable>

								<!-- Entity type -->
								<td><a href="nds://{$CurrentId}"><xsl:value-of select="$EntityName" /></a></td>

								<!-- Entity ID -->
								<td><xsl:call-template name="Linkify"><xsl:with-param name="String"><xsl:value-of select="." /></xsl:with-param></xsl:call-template></td>

								<!-- Niche ID -->
								<td>
									<xsl:call-template name="DisplayNicheId">
										<xsl:with-param name="EntityId" select="$CurrentId" />
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW" />
									</xsl:call-template>
								</td>

								<!-- Entity/search info -->
								<td>
									<xsl:call-template name="DisplaySummaryXMLOneLine">
										<xsl:with-param name="InstanceFieldName">ALAEInstanceActionData__Instance</xsl:with-param>
										<xsl:with-param name="EntityFieldName">ALAEInstanceActionData__InstanceIdEntityName</xsl:with-param>
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]" />
									</xsl:call-template>
									<xsl:call-template name="DisplaySummaryXMLOneLine">
										<xsl:with-param name="InstanceFieldName">ALAEClientDataOutput__SubjectInstance</xsl:with-param>
										<xsl:with-param name="EntityFieldName">ALAEClientDataOutput__SubjectInstanceIdEntityName</xsl:with-param>
										<xsl:with-param name="DataRoot" select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW[ALAEClientDataOutput__SubjectInstanceIdConverted = $CurrentId]" />
									</xsl:call-template>
									<xsl:if test="$TransactionType = 'Search'">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__LabelSearchSpec" />
									</xsl:if>
								</td>

								<!-- Role -->
								<td>
									<xsl:variable name="CurrentRole" select="msxsl:node-set($CurrentBatch)/Batch__EffectiveUserRoleIdConverted" />
									<a href="nds://{$CurrentRole}">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/../../DATASET/ROW[NACRole__Id = $CurrentRole]/NACRole__NameG" />
									</a>
								</td>

								<!-- Machine -->
								<td>
									<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__EffectiveWorkstation" />
									<xsl:if test="msxsl:node-set($CurrentBatch)/Batch__EffectiveWorkstation = ''">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__EffectiveIPAddress" />
									</xsl:if>
									<xsl:if test="msxsl:node-set($CurrentBatch)/Batch__EffectiveWorkstation != '' and $ShowIPAddress = '1'">
										<xsl:text> (</xsl:text>
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/Batch__EffectiveIPAddress" />
										<xsl:text>)</xsl:text>
									</xsl:if>
								</td>

								<!-- RFA entry -->
								<td><xsl:value-of select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW/DATASET/ROW/ALAECSReasonForAccess__Reason" /></td>

								<!-- Questionnaire results -->
								<td>
									<xsl:if test="($TransactionType = 'Insert' or $TransactionType = 'Update') and $EntityName = 'RequestLog'">
										<xsl:value-of select="msxsl:node-set($CurrentBatch)/DATASET/ROW/DATASET/ROW/ALAEInstanceActionData__InstanceSummaryXML/XML/RequestLog/Remarks" />
									</xsl:if>
								</td>
							</tr>
						</xsl:for-each>
					</xsl:template>


					<xsl:template name="DisplaySummaryXMLOneLine">
						<xsl:param name="InstanceFieldName" />
						<xsl:param name="EntityFieldName" />
						<xsl:param name="DataRoot" />

						<xsl:variable name="RecordIsConfidential" select="msxsl:node-set($DataRoot)/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/ProtectiveMarkingIsConfidential" />
						<xsl:variable name="EntityType" select="msxsl:node-set($DataRoot)/*[name() = $EntityFieldName]" />

						<xsl:if test="string-length($RecordIsConfidential) = 0 or $RecordIsConfidential = 'False' or ($RecordIsConfidential != 'False' and $ShowConfidential = '1')">
							<xsl:choose>
								<!-- Person -->
								<xsl:when test="$EntityType = 'Person'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Surname_cacheG" />
									<xsl:text>, </xsl:text>
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Given1_cache" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Given2_cache" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/Given3_cache" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/GenderG" /></String>
										</xsl:with-param>
									</xsl:call-template>
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/DateOfBirth_cacheG != ''">
										<xsl:text> - DOB:</xsl:text>
										<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Person/DateOfBirth_cacheG" />
									</xsl:if>

								</xsl:when>
								<!-- OrgGeneral/OrgCriminal-->
								<xsl:when test="$EntityType = 'OrgGeneral' or *[name() = $EntityFieldName] = 'OrgCriminal'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/Surname_cacheG" />
								</xsl:when>
								<!-- PhysicalAddress -->
								<xsl:when test="$EntityType = 'PhysicalAddress'">
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/CivicSiteStreetNumberG" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/StreetNameG" /></String>
											<String>
												<xsl:if test="($DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/CivicSiteStreetNumberG&#xD;&#xA;																or $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/StreetNameG)&#xD;&#xA;															and $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/MunicipalityNameG">
													<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/PhysicalAddress/MunicipalityNameG" />
												</xsl:if>
											</String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Telephone -->
								<xsl:when test="$EntityType = 'Telephone' or $EntityType = 'EMail'">
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/Type1G != ''">
										<xsl:text>(</xsl:text>
										<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/Type1G" />
										<xsl:text>) </xsl:text>
									</xsl:if>
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*[name() = $EntityType]/CommAddressG" />
								</xsl:when>
								<!-- Occurrence -->
								<xsl:when test="$EntityType = 'Occurrence'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceFileNoG" />
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceFileNoG != ''&#xD;&#xA;												and $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceStdOccTypeRId_L != ''">
										<xsl:text> - </xsl:text>
									</xsl:if>
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/Occurrence/OccurrenceStdOccTypeRId_L" />
								</xsl:when>
								<!-- SCOccurrence -->
								<xsl:when test="$EntityType = 'SCOccurrence'">
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/OccurrenceFileNoG" />
									<xsl:if test="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/OccurrenceFileNoG != ''&#xD;&#xA;												and $DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/ClassificationG != ''">
										<xsl:text> - </xsl:text>
									</xsl:if>
									<xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/SCOccurrence/ClassificationG" />
								</xsl:when>
								<!-- GPersonArrest -->
								<xsl:when test="$EntityType = 'GPersonArrest'">
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> - </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonArrest/LabelCustodyNumberG" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonArrest/LabelPersonFull" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonArrest/GPCStdReasonRId_L" /></String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- GPersonCharge -->
								<xsl:when test="$EntityType = 'GPersonCharge'">
									<xsl:call-template name="ComposeWith">
										<xsl:with-param name="Separator"><xsl:text> - </xsl:text></xsl:with-param>
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonCharge/OffenseDate1G" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonCharge/OffenseDate2G" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/GPersonCharge/GPChargeStdChargeRId_L" /></String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Default -->
								<!-- Includes CourtFolder, Report entities, Vehicle, PersonDescImage, and anything else not listed above -->
								<xsl:otherwise>
									<xsl:call-template name="DisplayFirstNonEmptyString">
										<xsl:with-param name="Strings">
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/Label" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelAssoc" /></String>
											<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelAudit" /></String>
											<String>
												<xsl:call-template name="ComposeWith">
													<xsl:with-param name="Separator">-</xsl:with-param>
													<xsl:with-param name="Strings">
														<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelLeft" /></String>
														<String><xsl:value-of select="$DataRoot/*[name() = concat($InstanceFieldName, 'SummaryXML')]/XML/*/LabelRight" /></String>
													</xsl:with-param>
												</xsl:call-template>
											</String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:otherwise>
							</xsl:choose>
						</xsl:if>

					</xsl:template>


					<xsl:template name="DisplayFirstNonEmptyString" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
						<xsl:param name="Strings" />
						<xsl:choose>
							<xsl:when test="count(msxsl:node-set($Strings)/String) = 0" />
							<xsl:when test="msxsl:node-set($Strings)/String[1] != ''"><xsl:value-of select="msxsl:node-set($Strings)/String[1]" /></xsl:when>
							<xsl:otherwise>
								<xsl:call-template name="DisplayFirstNonEmptyString">
									<xsl:with-param name="Strings">
										<xsl:for-each select="msxsl:node-set($Strings)/String[position() != 1]">
											<String><xsl:value-of select="." /></String>
										</xsl:for-each>
									</xsl:with-param>
								</xsl:call-template>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:template>



					<xsl:template name="Linkify">
						<xsl:param name="String" />
						<xsl:param name="Position">1</xsl:param>

						<xsl:if test="string-length($String) = 0"><xsl:text> </xsl:text></xsl:if>

						<xsl:if test="$Position &lt;= string-length($String)">

							<xsl:variable name="Digits">
								<xsl:call-template name="DigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position" />
								</xsl:call-template>
							</xsl:variable>

							<xsl:variable name="NonDigits">
								<xsl:call-template name="NonDigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position" />
								</xsl:call-template>
							</xsl:variable>

							<xsl:choose>
								<xsl:when test="$Digits &gt;= 23 and $Digits &lt;= 25">
									<xsl:variable name="Id" select="substring($String, $Position, $Digits)" />
									<a href="nds://{$Id}"><xsl:value-of select="$Id" /></a>
									<xsl:call-template name="Linkify">
										<xsl:with-param name="String" select="$String" />
										<xsl:with-param name="Position" select="$Position + $Digits" />
									</xsl:call-template>
								</xsl:when>
								<xsl:when test="$Digits &gt; 0">
									<xsl:value-of select="substring($String, $Position, $Digits)" />
									<xsl:call-template name="Linkify">
										<xsl:with-param name="String" select="$String" />
										<xsl:with-param name="Position" select="$Position + $Digits" />
									</xsl:call-template>
								</xsl:when>
								<xsl:otherwise>
									<xsl:value-of select="substring($String, $Position, $NonDigits)" />
									<xsl:call-template name="Linkify">
										<xsl:with-param name="String" select="$String" />
										<xsl:with-param name="Position" select="$Position + $NonDigits" />
									</xsl:call-template>
								</xsl:otherwise>
							</xsl:choose>

						</xsl:if>

					</xsl:template>


					<xsl:template name="DigitsFromPosition">
						<xsl:param name="String" />
						<xsl:param name="Position" />
						<xsl:param name="DigitsSoFar">0</xsl:param>

						<xsl:choose>
							<xsl:when test="$Position &gt; string-length($String)">
								<xsl:value-of select="$DigitsSoFar" />
							</xsl:when>
							<xsl:when test="number(substring($String, $Position, 1)) &gt; -1">
								<xsl:call-template name="DigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position + 1" />
									<xsl:with-param name="DigitsSoFar" select="$DigitsSoFar + 1" />
								</xsl:call-template>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="$DigitsSoFar" />
							</xsl:otherwise>
						</xsl:choose>

					</xsl:template>


					<xsl:template name="NonDigitsFromPosition">
						<xsl:param name="String" />
						<xsl:param name="Position" />
						<xsl:param name="NonDigitsSoFar">0</xsl:param>

						<xsl:choose>
							<xsl:when test="$Position &gt; string-length($String)">
								<xsl:value-of select="$NonDigitsSoFar" />
							</xsl:when>
							<xsl:when test="not(number(substring($String, $Position, 1)) &gt; -1)">
								<xsl:call-template name="NonDigitsFromPosition">
									<xsl:with-param name="String" select="$String" />
									<xsl:with-param name="Position" select="$Position + 1" />
									<xsl:with-param name="NonDigitsSoFar" select="$NonDigitsSoFar + 1" />
								</xsl:call-template>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="$NonDigitsSoFar" />
							</xsl:otherwise>
						</xsl:choose>

					</xsl:template>


					<xsl:template name="ConvertIdsToEntityNames">
						<xsl:param name="DataRoot" />
						<xsl:param name="Ids" />
						<xsl:for-each select="msxsl:node-set($Ids)/String[text() != '']">
							<xsl:variable name="CurrentId" select="." />
							<xsl:if test="count(msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]) &gt; 0">
								<a href="nds://{$CurrentId}">
									<xsl:value-of select="msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEInstanceActionData__InstanceIdConverted = $CurrentId]/ALAEInstanceActionData__InstanceIdEntityName" />
								</a>
								<xsl:if test="position() != last()">
									<xsl:text>, </xsl:text>
								</xsl:if>
							</xsl:if>
							<xsl:if test="count(msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEClientDataOutput__SubjectInstanceIdConverted = $CurrentId]) &gt; 0">
								<a href="nds://{$CurrentId}">
									<xsl:value-of select="msxsl:node-set($DataRoot)/DATASET/ROW/DATASET/ROW[ALAEClientDataOutput__SubjectInstanceIdConverted = $CurrentId]/ALAEClientDataOutput__SubjectInstanceIdDisplayName" />
								</a>
								<xsl:if test="position() != last()">
									<xsl:text>, </xsl:text>
								</xsl:if>
							</xsl:if>
						</xsl:for-each>
					</xsl:template>


				<xsl:template name="Split">
					<xsl:param name="String" />
					<xsl:param name="Delimiter" select="';'" />
					<xsl:param name="DiscardBlank" select="'0'" />

					<xsl:choose>
						<xsl:when test="not(contains($String, $Delimiter))">
							<xsl:if test="$String != '' or $DiscardBlank = '0'">
								<String><xsl:value-of select="$String" /></String>
							</xsl:if>
						</xsl:when>
						<xsl:otherwise>
							<xsl:if test="$DiscardBlank = '0' or ($DiscardBlank = '1' and substring-before($String, $Delimiter) != '')">
								<String><xsl:value-of select="substring-before($String, $Delimiter)" /></String>
							</xsl:if>
							<xsl:call-template name="Split">
								<xsl:with-param name="String" select="substring-after($String, $Delimiter)" />
								<xsl:with-param name="Delimiter" select="$Delimiter" />
								<xsl:with-param name="DiscardBlank" select="$DiscardBlank" />
							</xsl:call-template>
						</xsl:otherwise>
					</xsl:choose>

				</xsl:template>


				<xsl:template name="ComposeWith" xmlns:msxsl="urn:schemas-microsoft-com:xslt">
					<xsl:param name="Strings" />
					<xsl:param name="Separator">
						<xsl:text> / </xsl:text>
					</xsl:param>
					<xsl:for-each select="msxsl:node-set($Strings)/String">
						<xsl:if test="string-length(text()) &gt; 0 and count(preceding-sibling::String[string-length(.) &gt; 0]) &gt; 0">
							<xsl:value-of select="$Separator" />
						</xsl:if>
						<xsl:value-of select="./text()" />
					</xsl:for-each>
				</xsl:template>


					<!-- StyleClasses template -->
					<xsl:template name="StyleClasses">
						<xsl:element name="style">
							<xsl:attribute name="type">text/css</xsl:attribute>
							<xsl:text>


								BODY		{ font-size: 10pt; font-family:Arial; vertical-align:top; }
								H2			{ font-size: 12pt; font-style: italic; font-weight: bold; }
								H3			{ font-size: 10pt; font-style: italic; font-weight: bold; }
								H6			{ font-size: 8pt; font-weight:bold; margin-top:-10pt; text-align:center; }
								TH			{ text-align:left; border-color: silver; border-style: none none solid none; border-width:2px; font-size: 7pt; font-style: italic; vertical-align: bottom; }
								TABLE		{ font-size: 10pt; }

								TABLE.GridLayout	{ width:100%; font-size: 7pt; padding: 0px 2px 0px 2px; vertical-align: top; }
								HR.separator		{ display:none; }
								H1.TitleForeground	{ font-size: 16pt; font-weight: bold; margin-top:-20pt; text-align: center; border:solid black; border-width:2px 0 2px 0; }

								.TitleBackground	{ margin:0pt; border-top-width:19pt; border-style:solid; border-bottom-width:0pt; border-color:silver; display:block }




							.				{ font-size: 10pt; font-family: Arial; vertical-align:top; }
							.Data			{ font-size: 10pt; font-style: normal; }
							.Label			{ font-size: 10pt; font-style: italic; padding-left:0.2cm; vertical-align:top }
							.PrintedLabel	{ font-size:8pt; }
							.ReportHeader	{ font-size: 16pt; font-weight: bold; margin-top:-17pt; text-align: center; }
							.ReportHeader2	{ font-size: 12pt; font-style: italic; font-weight: bold; }
							.ReportHeader3	{ font-size: 10pt; font-style: italic; font-weight: bold; }
							.RestrictedUseLabel { font-style: italic; font-weight: bold; }
							.SilverLine		{ border-top: solid; border-top-width: 2px; border-color: silver; }
							.TableData		{ font-size: 7pt; padding: 0px 2px 0px 2px; vertical-align: top; }
							.TableHeader	{ border-color: silver; border-style: none none solid none; border-width:2px; font-size: 7pt; font-style: italic; vertical-align: bottom; }

							DIV.Data		{ display:inline; }
							DIV.Label		{ display:inline; font-weight: bold; width:18%; }
							DIV.DataItem	{ vertical-align:none; width:100%; }
							H2				{ font-size:12pt; }
							H3				{ font-size:10pt; }
							A				{ font-size:7pt;text-decoration:none; }
							TD				{ font-size:7pt; }
							LI				{ font-size:7pt; }
							</xsl:text>
						</xsl:element>
					</xsl:template>


				<!-- Title template -->
				<xsl:template name="Title" xmlns:pp="urn:nichePreprocessor">
					<xsl:param name="Text" />
					<span id="Title">
						<div class="TitleBackground"> </div>
						<h1 class="TitleForeground"><xsl:value-of select="$Text" /></h1>


					</span>
				</xsl:template>


			<!-- InfoBox template -->
				<xsl:template name="InfoBox" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:nl="urn:nicheLanguage" xmlns:pp="urn:nichePreprocessor">
					<xsl:param name="DataNodes" />
					<xsl:param name="SpecDesc" />
					<xsl:param name="ShowPrintedByUser">1</xsl:param>
					<xsl:param name="ShowTimestamp">1</xsl:param>
					<xsl:param name="ShowAgencyAndDivision">1</xsl:param>
					<xsl:param name="ShowInfoBoxBorder">1</xsl:param>
					<xsl:param name="ShowPoliceId1Label">0</xsl:param>
					<xsl:param name="UseCurEmpNumberInsteadOfCurrUser">0</xsl:param>

					<span id="InfoBox">
						<xsl:variable name="BorderStyle">
							<xsl:if test="$ShowInfoBoxBorder = 1">border-style:solid;border-width:1px;</xsl:if>
						</xsl:variable>
						<div style="{$BorderStyle}">
							<xsl:if test="$ShowAgencyAndDivision = '1' or $ShowPoliceId1Label = '1'">
								<div style="margin-bottom:0.2cm; padding: .25cm;">
									<xsl:variable name="AgencyName"><xsl:value-of select="/DATASETLIST/DATASET/ROW/AgencyName" /></xsl:variable>
									<xsl:variable name="DivisionName"><xsl:value-of select="/DATASETLIST/DATASET/ROW/DivisionName" /></xsl:variable>
									<xsl:if test="$ShowAgencyAndDivision = '1'">
										<xsl:value-of select="$AgencyName" />
										<xsl:if test="string-length($AgencyName) &gt; 0 and string-length($DivisionName) &gt; 0"><xsl:text>, </xsl:text></xsl:if>
										<xsl:value-of select="$DivisionName" />
									</xsl:if>
									<xsl:if test="$ShowPoliceId1Label = '1'">
										<xsl:variable name="PoliceId1Label">
											<xsl:choose>
												<xsl:when test="/DATASETLIST/DATASET/ROW/PoliceId1Label != ''">
													<xsl:value-of select="/DATASETLIST/DATASET/ROW/PoliceId1Label" />
												</xsl:when>
												<xsl:otherwise>
													<nl:mls><e>MNI:</e><f>MNI:</f><u>MNI:</u><a>MNI:</a><s>MNI:</s></nl:mls>
												</xsl:otherwise>
											</xsl:choose>
										</xsl:variable>
										<xsl:if test="string-length($PoliceId1Label) &gt; 0">
											<xsl:if test="$ShowAgencyAndDivision = '1' and (string-length($AgencyName) &gt; 0 or string-length($DivisionName) &gt; 0)"><xsl:text>, </xsl:text></xsl:if>
											<xsl:value-of select="$PoliceId1Label" />
										</xsl:if>
									</xsl:if>
								</div>
							</xsl:if>
							<xsl:if test="count(msxsl:node-set($DataNodes)/row) &gt; 0">
								<table width="97%" align="center" style="border:none">
									<colgroup>
										<col class="Label" width="21%" />
										<col width="79%" />
									</colgroup>
									<xsl:for-each select="msxsl:node-set($DataNodes)/row">
										<xsl:call-template name="InfoBoxLine">
											<xsl:with-param name="Label" select="label" />
											<xsl:with-param name="Data" select="value" />
											<xsl:with-param name="BoldLabel" select="label/@bold" />
											<xsl:with-param name="BoldData" select="value/@bold" />
										</xsl:call-template>
									</xsl:for-each>
								</table>
								<BR />
							</xsl:if>
							<xsl:if test="$ShowPrintedByUser = '1' or $ShowTimestamp = '1' or string-length($SpecDesc) &gt; 0">
								<div>
									<table width="97%" align="left" cellpadding="0" cellspacing="0" style="border:none">
										<tr>
											<td width="49%" class="PrintedLabel" style="vertical-align:bottom; border:none;">
												<xsl:if test="$ShowTimestamp = '1'">
													<xsl:text><nl:mls><e>Valid as of </e><f>Valide  partir de </f></nl:mls></xsl:text>
													<xsl:choose>
														<xsl:when test="/DATASETLIST/DATASET/ROW/DataTimestamp != ''">
															<xsl:value-of select="/DATASETLIST/DATASET/ROW/DataTimestamp" />
														</xsl:when>
														<xsl:otherwise>
															&lt;<xsl:text><nl:mls><e>Unknown</e><f>Inconnu</f></nl:mls></xsl:text>&gt;
														</xsl:otherwise>
													</xsl:choose>
												</xsl:if>
												<xsl:if test="$ShowPrintedByUser = '1'">
													<br />
													<xsl:text><nl:mls><e>Printed by </e><f>Imprim par </f></nl:mls></xsl:text>
													<xsl:choose>
														<xsl:when test="$UseCurEmpNumberInsteadOfCurrUser = '1'">
															<xsl:value-of select="/DATASETLIST/DATASET/ROW/CurrentEmployeeNumber" />
														</xsl:when>
														<xsl:otherwise>
															<xsl:value-of select="/DATASETLIST/DATASET/ROW/CurrentUser" />
														</xsl:otherwise>
													</xsl:choose>
												</xsl:if>
											</td>
											<td width="2%" style="border:none" />
											<td width="49%" class="PrintedLabel" style="vertical-align:bottom;text-align:right;border:none">
												<xsl:if test="string-length($SpecDesc) &gt; 0">
													<xsl:text><nl:mls><e>Summary for: </e><f>Sommaire pour: </f></nl:mls></xsl:text><xsl:value-of select="$SpecDesc" />
												</xsl:if>
											</td>
										</tr>
									</table>
								</div>
							</xsl:if>
						</div>
						<br />
					</span>
					<br />
				</xsl:template>

			<!-- InfoBoxLine template -->
				<xsl:template name="InfoBoxLine">
					<xsl:param name="Label" />
					<xsl:param name="Data" />
					<xsl:param name="BoldLabel">0</xsl:param>
					<xsl:param name="BoldData">0</xsl:param>
					<xsl:if test="$Label != '' or $Data != ''">
						<xsl:variable name="LabelStyle">
							<xsl:if test="$BoldLabel = 1">font-weight:bold;</xsl:if>
							<xsl:text>border:none;</xsl:text>
						</xsl:variable>
						<xsl:variable name="DataStyle">
							<xsl:if test="$BoldData = 1">font-weight:bold;</xsl:if>
							<xsl:text>border:none;</xsl:text>
						</xsl:variable>

						<tr>
							<td style="{$LabelStyle}">
								<xsl:value-of select="$Label" />
							</td>
							<td style="{$DataStyle}">
								<xsl:copy-of select="$Data" />
							</td>
						</tr>
					</xsl:if>
				</xsl:template>


  				<xsl:template name="DisplayNicheId">
						<xsl:param name="EntityId" />
						<xsl:param name="DataRoot" />

						<xsl:variable name="EntityNumber" select="substring($EntityId, 1, string-length($EntityId) - 20)" />
						<a href="nds://{$EntityId}">
							<xsl:choose>
								<!-- GOccurrence -->
								<xsl:when test="$EntityNumber = '903' or $EntityNumber = '901'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">OccurrenceFileNoG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Person -->
								<xsl:when test="$EntityNumber = '1500'">
									<xsl:call-template name="DisplayFirstNonEmptyString">
										<xsl:with-param name="Strings">
											<String>
												<xsl:call-template name="DisplayNicheIdForEntityType">
													<xsl:with-param name="DataRoot" select="$DataRoot" />
													<xsl:with-param name="EntityId" select="$EntityId" />
													<xsl:with-param name="NicheIdField">EmployeeNumber_cache</xsl:with-param>
												</xsl:call-template>
											</String>
											<String>
												<xsl:call-template name="DisplayNicheIdForEntityType">
													<xsl:with-param name="DataRoot" select="$DataRoot" />
													<xsl:with-param name="EntityId" select="$EntityId" />
													<xsl:with-param name="NicheIdField">PoliceId1_cache</xsl:with-param>
												</xsl:call-template>
											</String>
										</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Organization -->
								<xsl:when test="$EntityNumber = '1401' or $EntityNumber = '1402'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">EmployeeNumber_cache</xsl:with-param>
									</xsl:call-template>
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">PoliceId1_cache</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- CourtFolder -->
								<xsl:when test="$EntityNumber = '2000'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">IdNumberG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- GPersonArrest -->
								<xsl:when test="$EntityNumber = '1206'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">LabelCustodyNumberG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
								<!-- Task -->
								<xsl:when test="$EntityNumber = '10501'">
									<xsl:call-template name="DisplayNicheIdForEntityType">
										<xsl:with-param name="DataRoot" select="$DataRoot" />
										<xsl:with-param name="EntityId" select="$EntityId" />
										<xsl:with-param name="NicheIdField">TaskNumberG</xsl:with-param>
									</xsl:call-template>
								</xsl:when>
							</xsl:choose>
						</a>
					</xsl:template>

					<xsl:template name="DisplayNicheIdForEntityType">
						<xsl:param name="DataRoot" />
						<xsl:param name="EntityId" />
						<xsl:param name="NicheIdField" />

						<xsl:value-of select="msxsl:node-set($DataRoot)[ALAEInstanceActionData__InstanceIdConverted = $EntityId]/ALAEInstanceActionData__InstanceSummaryXML/XML/*/*[name() = $NicheIdField]" />
						<xsl:value-of select="msxsl:node-set($DataRoot)[ALAEClientDataOutput__SubjectInstanceIdConverted = $EntityId]/ALAEClientDataOutput__SubjectInstanceSummaryXML/XML/*/*[name() = $NicheIdField]" />
						<xsl:value-of select="msxsl:node-set($DataRoot)[Batch__ConnectedInstanceIdConverted = $EntityId][Batch__ConnectedInstanceIdConverted = $EntityId]/Batch__ConnectedInstanceSummaryXML/XML/*/*[name() = $NicheIdField]" />
					</xsl:template>


				</xsl:stylesheet>]]>
		</XSLT>
	</Report>


	<Report>
		<FileType>XML</FileType>
		<FileExtension>xml</FileExtension>
		<AllowPrint>1</AllowPrint>
		<AllowSave>1</AllowSave>
		<AllowPrintPreview>1</AllowPrintPreview>
		<AllowPagedPreview>1</AllowPagedPreview>
		<AllowEmail>1</AllowEmail>
		<XSLT>
			<![CDATA[<?xml version="1.0" encoding="Windows-1252" ?>
				<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:dt="urn:schemas-microsoft-com:datatypes">

					<xsl:output method="xml" indent="yes"/>

					<xsl:template match="/DATASETLIST">
						<xsl:call-template name="CopyNode">
							<xsl:with-param name="Node" select="." />
						</xsl:call-template>
					</xsl:template>

					<xsl:template name="CopyNode">
						<xsl:param name="Node" />

						<xsl:variable name="Prefix" select="substring-before(name($Node), '__')" />
						<xsl:variable name="FieldName">
							<xsl:call-template name="ReplaceUnderscoreCodes_XML">
								<xsl:with-param name="String" select="substring-after(name($Node), '__')" />
							</xsl:call-template>
						</xsl:variable>
						<xsl:choose>
							<xsl:when test="string-length($Prefix) = 0">
								<xsl:element name="{name($Node)}">
									<xsl:for-each select="@*">
										<xsl:copy-of select="." />
									</xsl:for-each>
									<xsl:for-each select="*">
										<xsl:call-template name="CopyNode">
											<xsl:with-param name="Node" select="." />
										</xsl:call-template>
									</xsl:for-each>
									<xsl:value-of select="./text()" />
								</xsl:element>
							</xsl:when>
							<xsl:otherwise>
								<xsl:element name="{$Prefix}__{$FieldName}">
									<xsl:for-each select="@*">
										<xsl:copy-of select="." />
									</xsl:for-each>
									<xsl:for-each select="*">
										<xsl:call-template name="CopyNode">
											<xsl:with-param name="Node" select="." />
										</xsl:call-template>
									</xsl:for-each>
									<xsl:value-of select="./text()" />
								</xsl:element>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:template>

					<xsl:template name="ReplaceUnderscoreCodes_XML">
						<xsl:param name="String" />
						<xsl:choose>
							<xsl:when test="contains($String, '__')">
								<xsl:value-of select="substring-before($String, '__')" />
								<xsl:choose>
									<xsl:when test="substring(substring-after($String, '__'), 1, 1) = 'S'"><xsl:text>_</xsl:text></xsl:when>
									<xsl:when test="substring(substring-after($String, '__'), 1, 1) = 'D'"><xsl:text></xsl:text></xsl:when>
									<xsl:when test="substring(substring-after($String, '__'), 1, 1) = 'A'"><xsl:text>_</xsl:text></xsl:when>
									<xsl:when test="substring(substring-after($String, '__'), 1, 1) = 'N'"><xsl:text>_Num</xsl:text></xsl:when>
								</xsl:choose>
								<xsl:call-template name="ReplaceUnderscoreCodes_XML">
									<xsl:with-param name="String" select="substring(substring-after($String, '__'), 2)" />
								</xsl:call-template>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="$String" />
							</xsl:otherwise>
						</xsl:choose>
					</xsl:template>
				</xsl:stylesheet>
			]]>
		</XSLT>
	</Report>


	<DatawindowDef>
		<![CDATA[
			declare FieldStatus edit
			{
				size = 1000;
				default = "GGGGGGGGG";
			};

			declare ShowConfidential checkbox
			{
				label = "Show confidential data:";
				default = "1";
			};

			declare MarkConfidential checkbox
			{
				label = "Mark confidential data:";
				default = "1";
			};

			declare UseNoLock checkbox
			{
				label = "Don't lock database";
			};

			declare ReportPurpose edit
			{
				label = "Reason for report:";
			};

			declare RecipientName edit
			{
				label = "Recipient name:";
			};

			declare RecipientUnit edit
			{
				label = "Recipient unit:";
			};

			declare RecipientTelephone edit
			{
				label = "Recipient telephone:";
			};

			declare StartTimeG edit
			{
				datatype = datetime;
				label = "Start time:";
				tag = "EntityName=AuditLogBatch;FieldName=FirstALAETimeTZV2GL";
			};

			declare EndTimeG edit
			{
				datatype = datetime;
				label = "End time:";
				tag = "EntityName=AuditLogBatch;FieldName=FirstALAETimeTZV2GL";
			};

			declare ShowInsert   checkbox { label = "Insert"; default = "1"; };
			declare ShowUpdate   checkbox { label = "Update"; default = "1"; };
			declare ShowDelete   checkbox { label = "Delete"; default = "1"; };
			declare ShowSelect   checkbox { label = "Select ('brush-by')"; };
			declare ShowGetImage checkbox { label = "Binary read"; default = "1"; };
			declare ShowSetImage checkbox { label = "Binary write"; default = "1"; };
			declare ShowSQL      checkbox { label = "SQL"; };
			declare ShowSearch   checkbox { label = "Search"; default = "1"; };
			declare ShowOpen     checkbox { label = "Window open"; default = "1"; };
			declare ShowPrint    checkbox { label = "Print"; default = "1"; };
			declare ShowPreview  checkbox { label = "Preview"; default = "1"; };
			declare ShowFileSave checkbox { label = "File save"; default = "1"; };
			declare ShowEmail    checkbox { label = "Email"; default = "1"; };

/*	This can replace the above checkboxes when we can add set controls to DDWs
			declare TransactionType set
			{
				label = "Transaction type:";
				choices =
				{
					"IN" {"Insert";}
					"UP" {"Update";}
					"DE" {"Delete";}
					"SL" {"Select (~"brush-by~")";}
					"GI" {"Binary read";}
					"SI" {"Binary write";}
					"SQ" {"SQL";}
					"SR" {"Search";}
					"OP" {"Window open";}
					"PT" {"Print";}
					"PV" {"Preview";}
					"FS" {"File save";}
					"EM" {"Email";}
				};
			};
*/
			declare ShowPeople checkbox { label = "People"; };
			declare ShowPhotos checkbox { label = "Person photos"; };
			declare ShowOrganizations checkbox { label = "Organisations"; };
			declare ShowAddresses checkbox { label = "Locations"; };
			declare ShowTelephones checkbox { label = "Telephone numbers"; };
			declare ShowEmails checkbox { label = "Email addresses"; };
			declare ShowVehicles checkbox { label = "Vehicles"; };
			declare ShowOccurrences checkbox { label = "Occurrences"; };
			declare ShowSCOccurrences checkbox { label = "Intelligence reports"; };
			declare ShowDocuments checkbox { label = "Documents"; };
			declare ShowCharges checkbox { label = "Offences"; };
			declare ShowCaseFiles checkbox { label = "Case files"; };

			declare AllowedEntityNumber edit
			{
				label = "Show other entity:";
				tag = "EntityName=ExtDocTemplateAllowedEntity;FieldName=AllowedEntityNumber";
			};

			declare ShowFailedLogons checkbox
			{
				label = "Show failed log-ons:";
				default = "1";
			};

			declare ShowIPAddress checkbox
			{
				label = "Show IP address:";
			};

			datawindowdef ParameterWindow "ParameterWindow"
			{
				//total width = 2432

				griddef
				{
					columns = 1;
					labelwidth = 800;
					fieldwidth = 300;
					leftmargin = 400;
				};

				// The report title.  This will span both columns.
				text Title
				{
					label = "Employee audit report";
					fontstyle = "Arial Black";
					fontsize = 12;
					fonteffect = italic!;
					location = page;
					align = center;
					height = 92;
				};

				break(90);


				griddef
				{
					columns = 2;
					labelwidth = 500;
					fieldwidth = 500;
					leftmargin = 10;
					rightmargin = 10;
					labelfieldspace = 20;
					rowspace = 18;
				};

				field ShowConfidential {width = 580; property ControlLabelWidth = "0";};
				field MarkConfidential {width = 560; property ControlLabelWidth = "0"; visible=expression "if (ShowConfidential = '1', 1, 0)"; };
				break(90);

				field ReportPurpose;
				field RecipientName;
				break;

				field RecipientUnit;
				field RecipientTelephone;
				break(90);

				field StartTimeG;
				field EndTimeG;
				break(90);


				field ShowPeople;
				field ShowInsert;
				break;

				field ShowPhotos;
				field ShowUpdate;
				break;

				field ShowOrganizations;
				field ShowDelete;
				break;

				field ShowAddresses;
				field ShowSelect {visible = false;};
				break;

				field ShowTelephones;
				field ShowGetImage;
				break;

				field ShowEmails;
				field ShowSetImage;
				break;

				field ShowVehicles;
				field ShowSQL {visible = false;};
				break;

				field ShowOccurrences;
				field ShowSearch;
				break;

				field ShowSCOccurrences;
				field ShowOpen;
				break;

				field ShowDocuments;
				skipcol;
				break;

				field ShowCharges;
				field ShowFailedLogons;
				break;

				field ShowCaseFiles;
				field ShowIPAddress;
				break;

				field AllowedEntityNumber;
				field UseNoLock;
				break;

				computedfield EntityName { expression="if (isNull(AllowedEntityNumber) or AllowedEntityNumber = '', '', md_GetName(md_GetEntityFromId(AllowedEntityNumber + '00000000000000000000')))"; };
				skipcol;
				break;

				field FieldStatus
				{
					visible = false;
				};

				// Used by the DW to validate the data
				computedfield valid
				{
					visible = false;
					expression =
						"if (len(StartTimeG) > 0 and len(EndTimeG) > 0, "
								"if (f_getdatetimecomparablecfromg(StartTimeG) <= f_getdatetimecomparablecfromg(EndTimeG), 'true', 'false'), 'false')";
				};

				// Used to display an error message to the user
				computedfield invalidfields
				{
					visible = false;
					expression =
						"if (f_nonull(StartTimeG) = '', "
							"'~t' + f_TranslateString('str:startdate') + '~n', '') + "
						"if (f_nonull(EndTimeG) = '', "
							"'~t' + f_TranslateString('str:enddate') + '~n', '') + "
						"if (f_nonull(StartTimeG) <> '' and f_nonull(EndTimeG) <> '', "
							"if (f_getdatetimecomparablecfromg(StartTimeG) > f_getdatetimecomparablecfromg(EndTimeG), "
							"'~t' + f_TranslateString('str:daterangewarning') + '~n', ''), '')";
				};

				computedfield EntityList
				{
					visible = false;
					expression =  "if (ShowPeople        = '1', f_StuffSQL('Person') + ', ', '')"
								"+ if (ShowPhotos        = '1', f_StuffSQL('PersonDescImage') + ', ', '')"
								"+ if (ShowOrganizations = '1', f_StuffSQL('OrgGeneral') + ', ' + f_StuffSQL('OrgCriminal') + ', ', '')"
								"+ if (ShowAddresses     = '1', f_StuffSQL('PhysicalAddress') + ', ', '')"
								"+ if (ShowTelephones    = '1', f_StuffSQL('Telephone') + ', ', '')"
								"+ if (ShowEmails        = '1', f_StuffSQL('EMail') + ', ', '')"
								"+ if (ShowVehicles      = '1', f_StuffSQL('Vehicle') + ', ', '')"
								"+ if (ShowOccurrences   = '1', f_StuffSQL('Occurrence') + ', ', '')"
								"+ if (ShowSCOccurrences = '1', f_StuffSQL('SCOccurrence') + ', ', '')"
								"+ if (ShowDocuments     = '1', f_StuffSQL('GPersonPolReport') + ', ' + f_StuffSQL('GOccReport') + ', ' + f_StuffSQL('GPropertyPolReport') + ', ' + f_StuffSQL('GAddressPolReport') + ', ' + f_StuffSQL('CourtFolderDocument') + ', ', '')"
								"+ if (ShowCharges       = '1', f_StuffSQL('GPersonCharge') + ', ', '')"
								"+ if (ShowCaseFiles     = '1', f_StuffSQL('CourtFolder') + ', ', '')"
								"+ if (f_NoNull(EntityName) <> '',  f_StuffSQL(EntityName) + ', ', '')";
				};

				computedfield Entities { visible = false; expression = "if (f_NoNull(EntityList) <> '', Left(EntityList, Len(EntityList) - 2), '')"; };

				computedfield EntitiesG
				{
					visible = false;
					expression =  "if (ShowPeople        = '1', 'People, ', '')"
								"+ if (ShowPhotos        = '1', 'Person photos, ', '')"
								"+ if (ShowOrganizations = '1', 'Organisations, ', '')"
								"+ if (ShowAddresses     = '1', 'Addresses, ', '')"
								"+ if (ShowTelephones    = '1', 'Telephone numbers, ', '')"
								"+ if (ShowEmails        = '1', 'Email addresses, ', '')"
								"+ if (ShowVehicles      = '1', 'Vehicles, ', '')"
								"+ if (ShowOccurrences   = '1', 'General occurrences, ', '')"
								"+ if (ShowSCOccurrences = '1', 'Intelligence occurrence, ', '')"
								"+ if (ShowDocuments     = '1', 'Documents, ', '')"
								"+ if (ShowCharges       = '1', 'Offences, ', '')"
								"+ if (ShowCaseFiles     = '1', 'Case files, ', '')";
				};

				computedfield TransactionType
				{
					visible = false;
					expression ="';'"
								"+ if (ShowInsert  = '1', 'IN;', '')"
								"+ if (ShowUpdate  = '1', 'UP;', '')"
								"+ if (ShowDelete  = '1', 'DE;', '')"
								"+ if (ShowSelect  = '1', 'SL;', '')"
								"+ if (ShowGetImage= '1', 'GI;', '')"
								"+ if (ShowSetImage= '1', 'SI;', '')"
								"+ if (ShowSQL     = '1', 'SQ;', '')"
								"+ if (ShowSearch  = '1', 'SR;', '')"
								"+ if (ShowOpen    = '1', 'OP;', '')";
				};

				computedfield TransactionTypeG
				{
					visible = false;
					expression =  "if (ShowInsert  = '1', 'Insert, ', '')"
								"+ if (ShowUpdate  = '1', 'Update, ', '')"
								"+ if (ShowDelete  = '1', 'Delete, ', '')"
								"+ if (ShowSelect  = '1', 'Select (~'brush-by~'), ', '')"
								"+ if (ShowGetImage= '1', 'Binary read, ', '')"
								"+ if (ShowSetImage= '1', 'Binary write, ', '')"
								"+ if (ShowSQL     = '1', 'SQL, ', '')"
								"+ if (ShowSearch  = '1', 'Search, ', '')"
								"+ if (ShowOpen    = '1', 'Window open, ', '')";
				};

				//computedfield TransactionTypeG { visible=false; expression="TransactionType"; };


                computedfield StartTime { visible = false; expression = "f_AdjustDateTimeCToUTC(f_GetDateTimeCFromGFillMissingOffset(StartTimeG))"; };
                computedfield EndTime { visible = false; expression = "f_AdjustDateTimeCToUTC(f_GetDateTimeCFromGFillMissingOffset(EndTimeG))"; };
			};

			group Parameter_Group "ParameterGroup"
			{
				ParameterWindow
			};
		]]>
	</DatawindowDef>
</root>